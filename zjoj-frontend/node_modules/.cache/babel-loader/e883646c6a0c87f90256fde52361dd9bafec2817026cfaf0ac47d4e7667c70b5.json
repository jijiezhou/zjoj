{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\nimport { isSafari, isWebkitWebView } from '../../../base/browser/browser.js';\nimport { $, addDisposableListener, getActiveDocument } from '../../../base/browser/dom.js';\nimport { DeferredPromise } from '../../../base/common/async.js';\nimport { Event } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { ILayoutService } from '../../layout/browser/layoutService.js';\nimport { ILogService } from '../../log/common/log.js';\nlet BrowserClipboardService = class BrowserClipboardService extends Disposable {\n  constructor(layoutService, logService) {\n    super();\n    this.layoutService = layoutService;\n    this.logService = logService;\n    this.mapTextToType = new Map(); // unsupported in web (only in-memory)\n    this.findText = ''; // unsupported in web (only in-memory)\n    this.resources = []; // unsupported in web (only in-memory)\n    if (isSafari || isWebkitWebView) {\n      this.installWebKitWriteTextWorkaround();\n    }\n  }\n  // In Safari, it has the following note:\n  //\n  // \"The request to write to the clipboard must be triggered during a user gesture.\n  // A call to clipboard.write or clipboard.writeText outside the scope of a user\n  // gesture(such as \"click\" or \"touch\" event handlers) will result in the immediate\n  // rejection of the promise returned by the API call.\"\n  // From: https://webkit.org/blog/10855/async-clipboard-api/\n  //\n  // Since extensions run in a web worker, and handle gestures in an asynchronous way,\n  // they are not classified by Safari as \"in response to a user gesture\" and will reject.\n  //\n  // This function sets up some handlers to work around that behavior.\n  installWebKitWriteTextWorkaround() {\n    const handler = () => {\n      const currentWritePromise = new DeferredPromise();\n      // Cancel the previous promise since we just created a new one in response to this new event\n      if (this.webKitPendingClipboardWritePromise && !this.webKitPendingClipboardWritePromise.isSettled) {\n        this.webKitPendingClipboardWritePromise.cancel();\n      }\n      this.webKitPendingClipboardWritePromise = currentWritePromise;\n      // The ctor of ClipboardItem allows you to pass in a promise that will resolve to a string.\n      // This allows us to pass in a Promise that will either be cancelled by another event or\n      // resolved with the contents of the first call to this.writeText.\n      // see https://developer.mozilla.org/en-US/docs/Web/API/ClipboardItem/ClipboardItem#parameters\n      navigator.clipboard.write([new ClipboardItem({\n        'text/plain': currentWritePromise.p\n      })]).catch(async err => {\n        if (!(err instanceof Error) || err.name !== 'NotAllowedError' || !currentWritePromise.isRejected) {\n          this.logService.error(err);\n        }\n      });\n    };\n    this._register(Event.runAndSubscribe(this.layoutService.onDidAddContainer, ({\n      container,\n      disposables\n    }) => {\n      disposables.add(addDisposableListener(container, 'click', handler));\n      disposables.add(addDisposableListener(container, 'keydown', handler));\n    }, {\n      container: this.layoutService.mainContainer,\n      disposables: this._store\n    }));\n  }\n  async writeText(text, type) {\n    // With type: only in-memory is supported\n    if (type) {\n      this.mapTextToType.set(type, text);\n      return;\n    }\n    if (this.webKitPendingClipboardWritePromise) {\n      // For Safari, we complete this Promise which allows the call to `navigator.clipboard.write()`\n      // above to resolve and successfully copy to the clipboard. If we let this continue, Safari\n      // would throw an error because this call stack doesn't appear to originate from a user gesture.\n      return this.webKitPendingClipboardWritePromise.complete(text);\n    }\n    // Guard access to navigator.clipboard with try/catch\n    // as we have seen DOMExceptions in certain browsers\n    // due to security policies.\n    try {\n      return await navigator.clipboard.writeText(text);\n    } catch (error) {\n      console.error(error);\n    }\n    // Fallback to textarea and execCommand solution\n    const activeDocument = getActiveDocument();\n    const activeElement = activeDocument.activeElement;\n    const textArea = activeDocument.body.appendChild($('textarea', {\n      'aria-hidden': true\n    }));\n    textArea.style.height = '1px';\n    textArea.style.width = '1px';\n    textArea.style.position = 'absolute';\n    textArea.value = text;\n    textArea.focus();\n    textArea.select();\n    activeDocument.execCommand('copy');\n    if (activeElement instanceof HTMLElement) {\n      activeElement.focus();\n    }\n    activeDocument.body.removeChild(textArea);\n    return;\n  }\n  async readText(type) {\n    // With type: only in-memory is supported\n    if (type) {\n      return this.mapTextToType.get(type) || '';\n    }\n    // Guard access to navigator.clipboard with try/catch\n    // as we have seen DOMExceptions in certain browsers\n    // due to security policies.\n    try {\n      return await navigator.clipboard.readText();\n    } catch (error) {\n      console.error(error);\n      return '';\n    }\n  }\n  async readFindText() {\n    return this.findText;\n  }\n  async writeFindText(text) {\n    this.findText = text;\n  }\n  async writeResources(resources) {\n    this.resources = resources;\n  }\n  async readResources() {\n    return this.resources;\n  }\n};\nBrowserClipboardService = __decorate([__param(0, ILayoutService), __param(1, ILogService)], BrowserClipboardService);\nexport { BrowserClipboardService };","map":{"version":3,"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","isSafari","isWebkitWebView","$","addDisposableListener","getActiveDocument","DeferredPromise","Event","Disposable","ILayoutService","ILogService","BrowserClipboardService","constructor","layoutService","logService","mapTextToType","Map","findText","resources","installWebKitWriteTextWorkaround","handler","currentWritePromise","webKitPendingClipboardWritePromise","isSettled","cancel","navigator","clipboard","write","ClipboardItem","p","catch","err","Error","name","isRejected","error","_register","runAndSubscribe","onDidAddContainer","container","disposables","add","mainContainer","_store","writeText","text","type","set","complete","console","activeDocument","activeElement","textArea","body","appendChild","style","height","width","position","value","focus","select","execCommand","HTMLElement","removeChild","readText","get","readFindText","writeFindText","writeResources","readResources"],"sources":["/Users/zj/projects/zjoj/zjoj-frontend/node_modules/monaco-editor/esm/vs/platform/clipboard/browser/clipboardService.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nimport { isSafari, isWebkitWebView } from '../../../base/browser/browser.js';\nimport { $, addDisposableListener, getActiveDocument } from '../../../base/browser/dom.js';\nimport { DeferredPromise } from '../../../base/common/async.js';\nimport { Event } from '../../../base/common/event.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { ILayoutService } from '../../layout/browser/layoutService.js';\nimport { ILogService } from '../../log/common/log.js';\nlet BrowserClipboardService = class BrowserClipboardService extends Disposable {\n    constructor(layoutService, logService) {\n        super();\n        this.layoutService = layoutService;\n        this.logService = logService;\n        this.mapTextToType = new Map(); // unsupported in web (only in-memory)\n        this.findText = ''; // unsupported in web (only in-memory)\n        this.resources = []; // unsupported in web (only in-memory)\n        if (isSafari || isWebkitWebView) {\n            this.installWebKitWriteTextWorkaround();\n        }\n    }\n    // In Safari, it has the following note:\n    //\n    // \"The request to write to the clipboard must be triggered during a user gesture.\n    // A call to clipboard.write or clipboard.writeText outside the scope of a user\n    // gesture(such as \"click\" or \"touch\" event handlers) will result in the immediate\n    // rejection of the promise returned by the API call.\"\n    // From: https://webkit.org/blog/10855/async-clipboard-api/\n    //\n    // Since extensions run in a web worker, and handle gestures in an asynchronous way,\n    // they are not classified by Safari as \"in response to a user gesture\" and will reject.\n    //\n    // This function sets up some handlers to work around that behavior.\n    installWebKitWriteTextWorkaround() {\n        const handler = () => {\n            const currentWritePromise = new DeferredPromise();\n            // Cancel the previous promise since we just created a new one in response to this new event\n            if (this.webKitPendingClipboardWritePromise && !this.webKitPendingClipboardWritePromise.isSettled) {\n                this.webKitPendingClipboardWritePromise.cancel();\n            }\n            this.webKitPendingClipboardWritePromise = currentWritePromise;\n            // The ctor of ClipboardItem allows you to pass in a promise that will resolve to a string.\n            // This allows us to pass in a Promise that will either be cancelled by another event or\n            // resolved with the contents of the first call to this.writeText.\n            // see https://developer.mozilla.org/en-US/docs/Web/API/ClipboardItem/ClipboardItem#parameters\n            navigator.clipboard.write([new ClipboardItem({\n                    'text/plain': currentWritePromise.p,\n                })]).catch(async (err) => {\n                if (!(err instanceof Error) || err.name !== 'NotAllowedError' || !currentWritePromise.isRejected) {\n                    this.logService.error(err);\n                }\n            });\n        };\n        this._register(Event.runAndSubscribe(this.layoutService.onDidAddContainer, ({ container, disposables }) => {\n            disposables.add(addDisposableListener(container, 'click', handler));\n            disposables.add(addDisposableListener(container, 'keydown', handler));\n        }, { container: this.layoutService.mainContainer, disposables: this._store }));\n    }\n    async writeText(text, type) {\n        // With type: only in-memory is supported\n        if (type) {\n            this.mapTextToType.set(type, text);\n            return;\n        }\n        if (this.webKitPendingClipboardWritePromise) {\n            // For Safari, we complete this Promise which allows the call to `navigator.clipboard.write()`\n            // above to resolve and successfully copy to the clipboard. If we let this continue, Safari\n            // would throw an error because this call stack doesn't appear to originate from a user gesture.\n            return this.webKitPendingClipboardWritePromise.complete(text);\n        }\n        // Guard access to navigator.clipboard with try/catch\n        // as we have seen DOMExceptions in certain browsers\n        // due to security policies.\n        try {\n            return await navigator.clipboard.writeText(text);\n        }\n        catch (error) {\n            console.error(error);\n        }\n        // Fallback to textarea and execCommand solution\n        const activeDocument = getActiveDocument();\n        const activeElement = activeDocument.activeElement;\n        const textArea = activeDocument.body.appendChild($('textarea', { 'aria-hidden': true }));\n        textArea.style.height = '1px';\n        textArea.style.width = '1px';\n        textArea.style.position = 'absolute';\n        textArea.value = text;\n        textArea.focus();\n        textArea.select();\n        activeDocument.execCommand('copy');\n        if (activeElement instanceof HTMLElement) {\n            activeElement.focus();\n        }\n        activeDocument.body.removeChild(textArea);\n        return;\n    }\n    async readText(type) {\n        // With type: only in-memory is supported\n        if (type) {\n            return this.mapTextToType.get(type) || '';\n        }\n        // Guard access to navigator.clipboard with try/catch\n        // as we have seen DOMExceptions in certain browsers\n        // due to security policies.\n        try {\n            return await navigator.clipboard.readText();\n        }\n        catch (error) {\n            console.error(error);\n            return '';\n        }\n    }\n    async readFindText() {\n        return this.findText;\n    }\n    async writeFindText(text) {\n        this.findText = text;\n    }\n    async writeResources(resources) {\n        this.resources = resources;\n    }\n    async readResources() {\n        return this.resources;\n    }\n};\nBrowserClipboardService = __decorate([\n    __param(0, ILayoutService),\n    __param(1, ILogService)\n], BrowserClipboardService);\nexport { BrowserClipboardService };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}