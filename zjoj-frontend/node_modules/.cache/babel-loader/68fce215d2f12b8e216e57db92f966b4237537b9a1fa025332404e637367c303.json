{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { coalesce } from '../../../../base/common/arrays.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { onUnexpectedExternalError } from '../../../../base/common/errors.js';\nimport { registerModelAndPositionCommand } from '../../../browser/editorExtensions.js';\nimport { ILanguageFeaturesService } from '../../../common/services/languageFeatures.js';\nimport { ReferencesModel } from './referencesModel.js';\nasync function getLocationLinks(model, position, registry, provide) {\n  const provider = registry.ordered(model);\n  // get results\n  const promises = provider.map(provider => {\n    return Promise.resolve(provide(provider, model, position)).then(undefined, err => {\n      onUnexpectedExternalError(err);\n      return undefined;\n    });\n  });\n  const values = await Promise.all(promises);\n  return coalesce(values.flat());\n}\nexport function getDefinitionsAtPosition(registry, model, position, token) {\n  return getLocationLinks(model, position, registry, (provider, model, position) => {\n    return provider.provideDefinition(model, position, token);\n  });\n}\nexport function getDeclarationsAtPosition(registry, model, position, token) {\n  return getLocationLinks(model, position, registry, (provider, model, position) => {\n    return provider.provideDeclaration(model, position, token);\n  });\n}\nexport function getImplementationsAtPosition(registry, model, position, token) {\n  return getLocationLinks(model, position, registry, (provider, model, position) => {\n    return provider.provideImplementation(model, position, token);\n  });\n}\nexport function getTypeDefinitionsAtPosition(registry, model, position, token) {\n  return getLocationLinks(model, position, registry, (provider, model, position) => {\n    return provider.provideTypeDefinition(model, position, token);\n  });\n}\nexport function getReferencesAtPosition(registry, model, position, compact, token) {\n  return getLocationLinks(model, position, registry, async (provider, model, position) => {\n    const result = await provider.provideReferences(model, position, {\n      includeDeclaration: true\n    }, token);\n    if (!compact || !result || result.length !== 2) {\n      return result;\n    }\n    const resultWithoutDeclaration = await provider.provideReferences(model, position, {\n      includeDeclaration: false\n    }, token);\n    if (resultWithoutDeclaration && resultWithoutDeclaration.length === 1) {\n      return resultWithoutDeclaration;\n    }\n    return result;\n  });\n}\n// -- API commands ----\nasync function _sortedAndDeduped(callback) {\n  const rawLinks = await callback();\n  const model = new ReferencesModel(rawLinks, '');\n  const modelLinks = model.references.map(ref => ref.link);\n  model.dispose();\n  return modelLinks;\n}\nregisterModelAndPositionCommand('_executeDefinitionProvider', (accessor, model, position) => {\n  const languageFeaturesService = accessor.get(ILanguageFeaturesService);\n  const promise = getDefinitionsAtPosition(languageFeaturesService.definitionProvider, model, position, CancellationToken.None);\n  return _sortedAndDeduped(() => promise);\n});\nregisterModelAndPositionCommand('_executeTypeDefinitionProvider', (accessor, model, position) => {\n  const languageFeaturesService = accessor.get(ILanguageFeaturesService);\n  const promise = getTypeDefinitionsAtPosition(languageFeaturesService.typeDefinitionProvider, model, position, CancellationToken.None);\n  return _sortedAndDeduped(() => promise);\n});\nregisterModelAndPositionCommand('_executeDeclarationProvider', (accessor, model, position) => {\n  const languageFeaturesService = accessor.get(ILanguageFeaturesService);\n  const promise = getDeclarationsAtPosition(languageFeaturesService.declarationProvider, model, position, CancellationToken.None);\n  return _sortedAndDeduped(() => promise);\n});\nregisterModelAndPositionCommand('_executeReferenceProvider', (accessor, model, position) => {\n  const languageFeaturesService = accessor.get(ILanguageFeaturesService);\n  const promise = getReferencesAtPosition(languageFeaturesService.referenceProvider, model, position, false, CancellationToken.None);\n  return _sortedAndDeduped(() => promise);\n});\nregisterModelAndPositionCommand('_executeImplementationProvider', (accessor, model, position) => {\n  const languageFeaturesService = accessor.get(ILanguageFeaturesService);\n  const promise = getImplementationsAtPosition(languageFeaturesService.implementationProvider, model, position, CancellationToken.None);\n  return _sortedAndDeduped(() => promise);\n});","map":{"version":3,"names":["coalesce","CancellationToken","onUnexpectedExternalError","registerModelAndPositionCommand","ILanguageFeaturesService","ReferencesModel","getLocationLinks","model","position","registry","provide","provider","ordered","promises","map","Promise","resolve","then","undefined","err","values","all","flat","getDefinitionsAtPosition","token","provideDefinition","getDeclarationsAtPosition","provideDeclaration","getImplementationsAtPosition","provideImplementation","getTypeDefinitionsAtPosition","provideTypeDefinition","getReferencesAtPosition","compact","result","provideReferences","includeDeclaration","length","resultWithoutDeclaration","_sortedAndDeduped","callback","rawLinks","modelLinks","references","ref","link","dispose","accessor","languageFeaturesService","get","promise","definitionProvider","None","typeDefinitionProvider","declarationProvider","referenceProvider","implementationProvider"],"sources":["/Users/zj/projects/zjoj/zjoj-frontend/node_modules/monaco-editor/esm/vs/editor/contrib/gotoSymbol/browser/goToSymbol.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { coalesce } from '../../../../base/common/arrays.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { onUnexpectedExternalError } from '../../../../base/common/errors.js';\nimport { registerModelAndPositionCommand } from '../../../browser/editorExtensions.js';\nimport { ILanguageFeaturesService } from '../../../common/services/languageFeatures.js';\nimport { ReferencesModel } from './referencesModel.js';\nasync function getLocationLinks(model, position, registry, provide) {\n    const provider = registry.ordered(model);\n    // get results\n    const promises = provider.map((provider) => {\n        return Promise.resolve(provide(provider, model, position)).then(undefined, err => {\n            onUnexpectedExternalError(err);\n            return undefined;\n        });\n    });\n    const values = await Promise.all(promises);\n    return coalesce(values.flat());\n}\nexport function getDefinitionsAtPosition(registry, model, position, token) {\n    return getLocationLinks(model, position, registry, (provider, model, position) => {\n        return provider.provideDefinition(model, position, token);\n    });\n}\nexport function getDeclarationsAtPosition(registry, model, position, token) {\n    return getLocationLinks(model, position, registry, (provider, model, position) => {\n        return provider.provideDeclaration(model, position, token);\n    });\n}\nexport function getImplementationsAtPosition(registry, model, position, token) {\n    return getLocationLinks(model, position, registry, (provider, model, position) => {\n        return provider.provideImplementation(model, position, token);\n    });\n}\nexport function getTypeDefinitionsAtPosition(registry, model, position, token) {\n    return getLocationLinks(model, position, registry, (provider, model, position) => {\n        return provider.provideTypeDefinition(model, position, token);\n    });\n}\nexport function getReferencesAtPosition(registry, model, position, compact, token) {\n    return getLocationLinks(model, position, registry, async (provider, model, position) => {\n        const result = await provider.provideReferences(model, position, { includeDeclaration: true }, token);\n        if (!compact || !result || result.length !== 2) {\n            return result;\n        }\n        const resultWithoutDeclaration = await provider.provideReferences(model, position, { includeDeclaration: false }, token);\n        if (resultWithoutDeclaration && resultWithoutDeclaration.length === 1) {\n            return resultWithoutDeclaration;\n        }\n        return result;\n    });\n}\n// -- API commands ----\nasync function _sortedAndDeduped(callback) {\n    const rawLinks = await callback();\n    const model = new ReferencesModel(rawLinks, '');\n    const modelLinks = model.references.map(ref => ref.link);\n    model.dispose();\n    return modelLinks;\n}\nregisterModelAndPositionCommand('_executeDefinitionProvider', (accessor, model, position) => {\n    const languageFeaturesService = accessor.get(ILanguageFeaturesService);\n    const promise = getDefinitionsAtPosition(languageFeaturesService.definitionProvider, model, position, CancellationToken.None);\n    return _sortedAndDeduped(() => promise);\n});\nregisterModelAndPositionCommand('_executeTypeDefinitionProvider', (accessor, model, position) => {\n    const languageFeaturesService = accessor.get(ILanguageFeaturesService);\n    const promise = getTypeDefinitionsAtPosition(languageFeaturesService.typeDefinitionProvider, model, position, CancellationToken.None);\n    return _sortedAndDeduped(() => promise);\n});\nregisterModelAndPositionCommand('_executeDeclarationProvider', (accessor, model, position) => {\n    const languageFeaturesService = accessor.get(ILanguageFeaturesService);\n    const promise = getDeclarationsAtPosition(languageFeaturesService.declarationProvider, model, position, CancellationToken.None);\n    return _sortedAndDeduped(() => promise);\n});\nregisterModelAndPositionCommand('_executeReferenceProvider', (accessor, model, position) => {\n    const languageFeaturesService = accessor.get(ILanguageFeaturesService);\n    const promise = getReferencesAtPosition(languageFeaturesService.referenceProvider, model, position, false, CancellationToken.None);\n    return _sortedAndDeduped(() => promise);\n});\nregisterModelAndPositionCommand('_executeImplementationProvider', (accessor, model, position) => {\n    const languageFeaturesService = accessor.get(ILanguageFeaturesService);\n    const promise = getImplementationsAtPosition(languageFeaturesService.implementationProvider, model, position, CancellationToken.None);\n    return _sortedAndDeduped(() => promise);\n});\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA,SAASA,QAAQ,QAAQ,mCAAmC;AAC5D,SAASC,iBAAiB,QAAQ,yCAAyC;AAC3E,SAASC,yBAAyB,QAAQ,mCAAmC;AAC7E,SAASC,+BAA+B,QAAQ,sCAAsC;AACtF,SAASC,wBAAwB,QAAQ,8CAA8C;AACvF,SAASC,eAAe,QAAQ,sBAAsB;AACtD,eAAeC,gBAAgBA,CAACC,KAAK,EAAEC,QAAQ,EAAEC,QAAQ,EAAEC,OAAO,EAAE;EAChE,MAAMC,QAAQ,GAAGF,QAAQ,CAACG,OAAO,CAACL,KAAK,CAAC;EACxC;EACA,MAAMM,QAAQ,GAAGF,QAAQ,CAACG,GAAG,CAAEH,QAAQ,IAAK;IACxC,OAAOI,OAAO,CAACC,OAAO,CAACN,OAAO,CAACC,QAAQ,EAAEJ,KAAK,EAAEC,QAAQ,CAAC,CAAC,CAACS,IAAI,CAACC,SAAS,EAAEC,GAAG,IAAI;MAC9EjB,yBAAyB,CAACiB,GAAG,CAAC;MAC9B,OAAOD,SAAS;IACpB,CAAC,CAAC;EACN,CAAC,CAAC;EACF,MAAME,MAAM,GAAG,MAAML,OAAO,CAACM,GAAG,CAACR,QAAQ,CAAC;EAC1C,OAAOb,QAAQ,CAACoB,MAAM,CAACE,IAAI,CAAC,CAAC,CAAC;AAClC;AACA,OAAO,SAASC,wBAAwBA,CAACd,QAAQ,EAAEF,KAAK,EAAEC,QAAQ,EAAEgB,KAAK,EAAE;EACvE,OAAOlB,gBAAgB,CAACC,KAAK,EAAEC,QAAQ,EAAEC,QAAQ,EAAE,CAACE,QAAQ,EAAEJ,KAAK,EAAEC,QAAQ,KAAK;IAC9E,OAAOG,QAAQ,CAACc,iBAAiB,CAAClB,KAAK,EAAEC,QAAQ,EAAEgB,KAAK,CAAC;EAC7D,CAAC,CAAC;AACN;AACA,OAAO,SAASE,yBAAyBA,CAACjB,QAAQ,EAAEF,KAAK,EAAEC,QAAQ,EAAEgB,KAAK,EAAE;EACxE,OAAOlB,gBAAgB,CAACC,KAAK,EAAEC,QAAQ,EAAEC,QAAQ,EAAE,CAACE,QAAQ,EAAEJ,KAAK,EAAEC,QAAQ,KAAK;IAC9E,OAAOG,QAAQ,CAACgB,kBAAkB,CAACpB,KAAK,EAAEC,QAAQ,EAAEgB,KAAK,CAAC;EAC9D,CAAC,CAAC;AACN;AACA,OAAO,SAASI,4BAA4BA,CAACnB,QAAQ,EAAEF,KAAK,EAAEC,QAAQ,EAAEgB,KAAK,EAAE;EAC3E,OAAOlB,gBAAgB,CAACC,KAAK,EAAEC,QAAQ,EAAEC,QAAQ,EAAE,CAACE,QAAQ,EAAEJ,KAAK,EAAEC,QAAQ,KAAK;IAC9E,OAAOG,QAAQ,CAACkB,qBAAqB,CAACtB,KAAK,EAAEC,QAAQ,EAAEgB,KAAK,CAAC;EACjE,CAAC,CAAC;AACN;AACA,OAAO,SAASM,4BAA4BA,CAACrB,QAAQ,EAAEF,KAAK,EAAEC,QAAQ,EAAEgB,KAAK,EAAE;EAC3E,OAAOlB,gBAAgB,CAACC,KAAK,EAAEC,QAAQ,EAAEC,QAAQ,EAAE,CAACE,QAAQ,EAAEJ,KAAK,EAAEC,QAAQ,KAAK;IAC9E,OAAOG,QAAQ,CAACoB,qBAAqB,CAACxB,KAAK,EAAEC,QAAQ,EAAEgB,KAAK,CAAC;EACjE,CAAC,CAAC;AACN;AACA,OAAO,SAASQ,uBAAuBA,CAACvB,QAAQ,EAAEF,KAAK,EAAEC,QAAQ,EAAEyB,OAAO,EAAET,KAAK,EAAE;EAC/E,OAAOlB,gBAAgB,CAACC,KAAK,EAAEC,QAAQ,EAAEC,QAAQ,EAAE,OAAOE,QAAQ,EAAEJ,KAAK,EAAEC,QAAQ,KAAK;IACpF,MAAM0B,MAAM,GAAG,MAAMvB,QAAQ,CAACwB,iBAAiB,CAAC5B,KAAK,EAAEC,QAAQ,EAAE;MAAE4B,kBAAkB,EAAE;IAAK,CAAC,EAAEZ,KAAK,CAAC;IACrG,IAAI,CAACS,OAAO,IAAI,CAACC,MAAM,IAAIA,MAAM,CAACG,MAAM,KAAK,CAAC,EAAE;MAC5C,OAAOH,MAAM;IACjB;IACA,MAAMI,wBAAwB,GAAG,MAAM3B,QAAQ,CAACwB,iBAAiB,CAAC5B,KAAK,EAAEC,QAAQ,EAAE;MAAE4B,kBAAkB,EAAE;IAAM,CAAC,EAAEZ,KAAK,CAAC;IACxH,IAAIc,wBAAwB,IAAIA,wBAAwB,CAACD,MAAM,KAAK,CAAC,EAAE;MACnE,OAAOC,wBAAwB;IACnC;IACA,OAAOJ,MAAM;EACjB,CAAC,CAAC;AACN;AACA;AACA,eAAeK,iBAAiBA,CAACC,QAAQ,EAAE;EACvC,MAAMC,QAAQ,GAAG,MAAMD,QAAQ,CAAC,CAAC;EACjC,MAAMjC,KAAK,GAAG,IAAIF,eAAe,CAACoC,QAAQ,EAAE,EAAE,CAAC;EAC/C,MAAMC,UAAU,GAAGnC,KAAK,CAACoC,UAAU,CAAC7B,GAAG,CAAC8B,GAAG,IAAIA,GAAG,CAACC,IAAI,CAAC;EACxDtC,KAAK,CAACuC,OAAO,CAAC,CAAC;EACf,OAAOJ,UAAU;AACrB;AACAvC,+BAA+B,CAAC,4BAA4B,EAAE,CAAC4C,QAAQ,EAAExC,KAAK,EAAEC,QAAQ,KAAK;EACzF,MAAMwC,uBAAuB,GAAGD,QAAQ,CAACE,GAAG,CAAC7C,wBAAwB,CAAC;EACtE,MAAM8C,OAAO,GAAG3B,wBAAwB,CAACyB,uBAAuB,CAACG,kBAAkB,EAAE5C,KAAK,EAAEC,QAAQ,EAAEP,iBAAiB,CAACmD,IAAI,CAAC;EAC7H,OAAOb,iBAAiB,CAAC,MAAMW,OAAO,CAAC;AAC3C,CAAC,CAAC;AACF/C,+BAA+B,CAAC,gCAAgC,EAAE,CAAC4C,QAAQ,EAAExC,KAAK,EAAEC,QAAQ,KAAK;EAC7F,MAAMwC,uBAAuB,GAAGD,QAAQ,CAACE,GAAG,CAAC7C,wBAAwB,CAAC;EACtE,MAAM8C,OAAO,GAAGpB,4BAA4B,CAACkB,uBAAuB,CAACK,sBAAsB,EAAE9C,KAAK,EAAEC,QAAQ,EAAEP,iBAAiB,CAACmD,IAAI,CAAC;EACrI,OAAOb,iBAAiB,CAAC,MAAMW,OAAO,CAAC;AAC3C,CAAC,CAAC;AACF/C,+BAA+B,CAAC,6BAA6B,EAAE,CAAC4C,QAAQ,EAAExC,KAAK,EAAEC,QAAQ,KAAK;EAC1F,MAAMwC,uBAAuB,GAAGD,QAAQ,CAACE,GAAG,CAAC7C,wBAAwB,CAAC;EACtE,MAAM8C,OAAO,GAAGxB,yBAAyB,CAACsB,uBAAuB,CAACM,mBAAmB,EAAE/C,KAAK,EAAEC,QAAQ,EAAEP,iBAAiB,CAACmD,IAAI,CAAC;EAC/H,OAAOb,iBAAiB,CAAC,MAAMW,OAAO,CAAC;AAC3C,CAAC,CAAC;AACF/C,+BAA+B,CAAC,2BAA2B,EAAE,CAAC4C,QAAQ,EAAExC,KAAK,EAAEC,QAAQ,KAAK;EACxF,MAAMwC,uBAAuB,GAAGD,QAAQ,CAACE,GAAG,CAAC7C,wBAAwB,CAAC;EACtE,MAAM8C,OAAO,GAAGlB,uBAAuB,CAACgB,uBAAuB,CAACO,iBAAiB,EAAEhD,KAAK,EAAEC,QAAQ,EAAE,KAAK,EAAEP,iBAAiB,CAACmD,IAAI,CAAC;EAClI,OAAOb,iBAAiB,CAAC,MAAMW,OAAO,CAAC;AAC3C,CAAC,CAAC;AACF/C,+BAA+B,CAAC,gCAAgC,EAAE,CAAC4C,QAAQ,EAAExC,KAAK,EAAEC,QAAQ,KAAK;EAC7F,MAAMwC,uBAAuB,GAAGD,QAAQ,CAACE,GAAG,CAAC7C,wBAAwB,CAAC;EACtE,MAAM8C,OAAO,GAAGtB,4BAA4B,CAACoB,uBAAuB,CAACQ,sBAAsB,EAAEjD,KAAK,EAAEC,QAAQ,EAAEP,iBAAiB,CAACmD,IAAI,CAAC;EACrI,OAAOb,iBAAiB,CAAC,MAAMW,OAAO,CAAC;AAC3C,CAAC,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}