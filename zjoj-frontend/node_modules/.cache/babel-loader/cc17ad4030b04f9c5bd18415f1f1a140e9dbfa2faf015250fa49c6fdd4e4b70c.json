{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { coalesce } from '../../../../base/common/arrays.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { onUnexpectedExternalError } from '../../../../base/common/errors.js';\nimport { DisposableStore, isDisposable } from '../../../../base/common/lifecycle.js';\nimport { assertType } from '../../../../base/common/types.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { Range } from '../../../common/core/range.js';\nimport { IModelService } from '../../../common/services/model.js';\nimport { CommandsRegistry } from '../../../../platform/commands/common/commands.js';\nimport { ILanguageFeaturesService } from '../../../common/services/languageFeatures.js';\nexport class Link {\n  constructor(link, provider) {\n    this._link = link;\n    this._provider = provider;\n  }\n  toJSON() {\n    return {\n      range: this.range,\n      url: this.url,\n      tooltip: this.tooltip\n    };\n  }\n  get range() {\n    return this._link.range;\n  }\n  get url() {\n    return this._link.url;\n  }\n  get tooltip() {\n    return this._link.tooltip;\n  }\n  async resolve(token) {\n    if (this._link.url) {\n      return this._link.url;\n    }\n    if (typeof this._provider.resolveLink === 'function') {\n      return Promise.resolve(this._provider.resolveLink(this._link, token)).then(value => {\n        this._link = value || this._link;\n        if (this._link.url) {\n          // recurse\n          return this.resolve(token);\n        }\n        return Promise.reject(new Error('missing'));\n      });\n    }\n    return Promise.reject(new Error('missing'));\n  }\n}\nexport class LinksList {\n  constructor(tuples) {\n    this._disposables = new DisposableStore();\n    let links = [];\n    for (const [list, provider] of tuples) {\n      // merge all links\n      const newLinks = list.links.map(link => new Link(link, provider));\n      links = LinksList._union(links, newLinks);\n      // register disposables\n      if (isDisposable(list)) {\n        this._disposables.add(list);\n      }\n    }\n    this.links = links;\n  }\n  dispose() {\n    this._disposables.dispose();\n    this.links.length = 0;\n  }\n  static _union(oldLinks, newLinks) {\n    // reunite oldLinks with newLinks and remove duplicates\n    const result = [];\n    let oldIndex;\n    let oldLen;\n    let newIndex;\n    let newLen;\n    for (oldIndex = 0, newIndex = 0, oldLen = oldLinks.length, newLen = newLinks.length; oldIndex < oldLen && newIndex < newLen;) {\n      const oldLink = oldLinks[oldIndex];\n      const newLink = newLinks[newIndex];\n      if (Range.areIntersectingOrTouching(oldLink.range, newLink.range)) {\n        // Remove the oldLink\n        oldIndex++;\n        continue;\n      }\n      const comparisonResult = Range.compareRangesUsingStarts(oldLink.range, newLink.range);\n      if (comparisonResult < 0) {\n        // oldLink is before\n        result.push(oldLink);\n        oldIndex++;\n      } else {\n        // newLink is before\n        result.push(newLink);\n        newIndex++;\n      }\n    }\n    for (; oldIndex < oldLen; oldIndex++) {\n      result.push(oldLinks[oldIndex]);\n    }\n    for (; newIndex < newLen; newIndex++) {\n      result.push(newLinks[newIndex]);\n    }\n    return result;\n  }\n}\nexport function getLinks(providers, model, token) {\n  const lists = [];\n  // ask all providers for links in parallel\n  const promises = providers.ordered(model).reverse().map((provider, i) => {\n    return Promise.resolve(provider.provideLinks(model, token)).then(result => {\n      if (result) {\n        lists[i] = [result, provider];\n      }\n    }, onUnexpectedExternalError);\n  });\n  return Promise.all(promises).then(() => {\n    const result = new LinksList(coalesce(lists));\n    if (!token.isCancellationRequested) {\n      return result;\n    }\n    result.dispose();\n    return new LinksList([]);\n  });\n}\nCommandsRegistry.registerCommand('_executeLinkProvider', async (accessor, ...args) => {\n  let [uri, resolveCount] = args;\n  assertType(uri instanceof URI);\n  if (typeof resolveCount !== 'number') {\n    resolveCount = 0;\n  }\n  const {\n    linkProvider\n  } = accessor.get(ILanguageFeaturesService);\n  const model = accessor.get(IModelService).getModel(uri);\n  if (!model) {\n    return [];\n  }\n  const list = await getLinks(linkProvider, model, CancellationToken.None);\n  if (!list) {\n    return [];\n  }\n  // resolve links\n  for (let i = 0; i < Math.min(resolveCount, list.links.length); i++) {\n    await list.links[i].resolve(CancellationToken.None);\n  }\n  const result = list.links.slice(0);\n  list.dispose();\n  return result;\n});","map":{"version":3,"names":["coalesce","CancellationToken","onUnexpectedExternalError","DisposableStore","isDisposable","assertType","URI","Range","IModelService","CommandsRegistry","ILanguageFeaturesService","Link","constructor","link","provider","_link","_provider","toJSON","range","url","tooltip","resolve","token","resolveLink","Promise","then","value","reject","Error","LinksList","tuples","_disposables","links","list","newLinks","map","_union","add","dispose","length","oldLinks","result","oldIndex","oldLen","newIndex","newLen","oldLink","newLink","areIntersectingOrTouching","comparisonResult","compareRangesUsingStarts","push","getLinks","providers","model","lists","promises","ordered","reverse","i","provideLinks","all","isCancellationRequested","registerCommand","accessor","args","uri","resolveCount","linkProvider","get","getModel","None","Math","min","slice"],"sources":["/Users/zj/projects/zjoj/zjoj-frontend/node_modules/monaco-editor/esm/vs/editor/contrib/links/browser/getLinks.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { coalesce } from '../../../../base/common/arrays.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { onUnexpectedExternalError } from '../../../../base/common/errors.js';\nimport { DisposableStore, isDisposable } from '../../../../base/common/lifecycle.js';\nimport { assertType } from '../../../../base/common/types.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { Range } from '../../../common/core/range.js';\nimport { IModelService } from '../../../common/services/model.js';\nimport { CommandsRegistry } from '../../../../platform/commands/common/commands.js';\nimport { ILanguageFeaturesService } from '../../../common/services/languageFeatures.js';\nexport class Link {\n    constructor(link, provider) {\n        this._link = link;\n        this._provider = provider;\n    }\n    toJSON() {\n        return {\n            range: this.range,\n            url: this.url,\n            tooltip: this.tooltip\n        };\n    }\n    get range() {\n        return this._link.range;\n    }\n    get url() {\n        return this._link.url;\n    }\n    get tooltip() {\n        return this._link.tooltip;\n    }\n    async resolve(token) {\n        if (this._link.url) {\n            return this._link.url;\n        }\n        if (typeof this._provider.resolveLink === 'function') {\n            return Promise.resolve(this._provider.resolveLink(this._link, token)).then(value => {\n                this._link = value || this._link;\n                if (this._link.url) {\n                    // recurse\n                    return this.resolve(token);\n                }\n                return Promise.reject(new Error('missing'));\n            });\n        }\n        return Promise.reject(new Error('missing'));\n    }\n}\nexport class LinksList {\n    constructor(tuples) {\n        this._disposables = new DisposableStore();\n        let links = [];\n        for (const [list, provider] of tuples) {\n            // merge all links\n            const newLinks = list.links.map(link => new Link(link, provider));\n            links = LinksList._union(links, newLinks);\n            // register disposables\n            if (isDisposable(list)) {\n                this._disposables.add(list);\n            }\n        }\n        this.links = links;\n    }\n    dispose() {\n        this._disposables.dispose();\n        this.links.length = 0;\n    }\n    static _union(oldLinks, newLinks) {\n        // reunite oldLinks with newLinks and remove duplicates\n        const result = [];\n        let oldIndex;\n        let oldLen;\n        let newIndex;\n        let newLen;\n        for (oldIndex = 0, newIndex = 0, oldLen = oldLinks.length, newLen = newLinks.length; oldIndex < oldLen && newIndex < newLen;) {\n            const oldLink = oldLinks[oldIndex];\n            const newLink = newLinks[newIndex];\n            if (Range.areIntersectingOrTouching(oldLink.range, newLink.range)) {\n                // Remove the oldLink\n                oldIndex++;\n                continue;\n            }\n            const comparisonResult = Range.compareRangesUsingStarts(oldLink.range, newLink.range);\n            if (comparisonResult < 0) {\n                // oldLink is before\n                result.push(oldLink);\n                oldIndex++;\n            }\n            else {\n                // newLink is before\n                result.push(newLink);\n                newIndex++;\n            }\n        }\n        for (; oldIndex < oldLen; oldIndex++) {\n            result.push(oldLinks[oldIndex]);\n        }\n        for (; newIndex < newLen; newIndex++) {\n            result.push(newLinks[newIndex]);\n        }\n        return result;\n    }\n}\nexport function getLinks(providers, model, token) {\n    const lists = [];\n    // ask all providers for links in parallel\n    const promises = providers.ordered(model).reverse().map((provider, i) => {\n        return Promise.resolve(provider.provideLinks(model, token)).then(result => {\n            if (result) {\n                lists[i] = [result, provider];\n            }\n        }, onUnexpectedExternalError);\n    });\n    return Promise.all(promises).then(() => {\n        const result = new LinksList(coalesce(lists));\n        if (!token.isCancellationRequested) {\n            return result;\n        }\n        result.dispose();\n        return new LinksList([]);\n    });\n}\nCommandsRegistry.registerCommand('_executeLinkProvider', async (accessor, ...args) => {\n    let [uri, resolveCount] = args;\n    assertType(uri instanceof URI);\n    if (typeof resolveCount !== 'number') {\n        resolveCount = 0;\n    }\n    const { linkProvider } = accessor.get(ILanguageFeaturesService);\n    const model = accessor.get(IModelService).getModel(uri);\n    if (!model) {\n        return [];\n    }\n    const list = await getLinks(linkProvider, model, CancellationToken.None);\n    if (!list) {\n        return [];\n    }\n    // resolve links\n    for (let i = 0; i < Math.min(resolveCount, list.links.length); i++) {\n        await list.links[i].resolve(CancellationToken.None);\n    }\n    const result = list.links.slice(0);\n    list.dispose();\n    return result;\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}