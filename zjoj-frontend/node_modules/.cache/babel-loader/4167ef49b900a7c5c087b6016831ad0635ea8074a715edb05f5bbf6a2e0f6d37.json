{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\nvar GotoDefinitionAtPositionEditorContribution_1;\nimport { createCancelablePromise } from '../../../../../base/common/async.js';\nimport { onUnexpectedError } from '../../../../../base/common/errors.js';\nimport { MarkdownString } from '../../../../../base/common/htmlContent.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport './goToDefinitionAtPosition.css';\nimport { EditorState } from '../../../editorState/browser/editorState.js';\nimport { registerEditorContribution } from '../../../../browser/editorExtensions.js';\nimport { Range } from '../../../../common/core/range.js';\nimport { ILanguageService } from '../../../../common/languages/language.js';\nimport { ITextModelService } from '../../../../common/services/resolverService.js';\nimport { ClickLinkGesture } from './clickLinkGesture.js';\nimport { PeekContext } from '../../../peekView/browser/peekView.js';\nimport * as nls from '../../../../../nls.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { DefinitionAction } from '../goToCommands.js';\nimport { getDefinitionsAtPosition } from '../goToSymbol.js';\nimport { ILanguageFeaturesService } from '../../../../common/services/languageFeatures.js';\nimport { ModelDecorationInjectedTextOptions } from '../../../../common/model/textModel.js';\nlet GotoDefinitionAtPositionEditorContribution = GotoDefinitionAtPositionEditorContribution_1 = class GotoDefinitionAtPositionEditorContribution {\n  constructor(editor, textModelResolverService, languageService, languageFeaturesService) {\n    this.textModelResolverService = textModelResolverService;\n    this.languageService = languageService;\n    this.languageFeaturesService = languageFeaturesService;\n    this.toUnhook = new DisposableStore();\n    this.toUnhookForKeyboard = new DisposableStore();\n    this.currentWordAtPosition = null;\n    this.previousPromise = null;\n    this.editor = editor;\n    this.linkDecorations = this.editor.createDecorationsCollection();\n    const linkGesture = new ClickLinkGesture(editor);\n    this.toUnhook.add(linkGesture);\n    this.toUnhook.add(linkGesture.onMouseMoveOrRelevantKeyDown(([mouseEvent, keyboardEvent]) => {\n      this.startFindDefinitionFromMouse(mouseEvent, keyboardEvent !== null && keyboardEvent !== void 0 ? keyboardEvent : undefined);\n    }));\n    this.toUnhook.add(linkGesture.onExecute(mouseEvent => {\n      if (this.isEnabled(mouseEvent)) {\n        this.gotoDefinition(mouseEvent.target.position, mouseEvent.hasSideBySideModifier).catch(error => {\n          onUnexpectedError(error);\n        }).finally(() => {\n          this.removeLinkDecorations();\n        });\n      }\n    }));\n    this.toUnhook.add(linkGesture.onCancel(() => {\n      this.removeLinkDecorations();\n      this.currentWordAtPosition = null;\n    }));\n  }\n  static get(editor) {\n    return editor.getContribution(GotoDefinitionAtPositionEditorContribution_1.ID);\n  }\n  async startFindDefinitionFromCursor(position) {\n    // For issue: https://github.com/microsoft/vscode/issues/46257\n    // equivalent to mouse move with meta/ctrl key\n    // First find the definition and add decorations\n    // to the editor to be shown with the content hover widget\n    await this.startFindDefinition(position);\n    // Add listeners for editor cursor move and key down events\n    // Dismiss the \"extended\" editor decorations when the user hides\n    // the hover widget. There is no event for the widget itself so these\n    // serve as a best effort. After removing the link decorations, the hover\n    // widget is clean and will only show declarations per next request.\n    this.toUnhookForKeyboard.add(this.editor.onDidChangeCursorPosition(() => {\n      this.currentWordAtPosition = null;\n      this.removeLinkDecorations();\n      this.toUnhookForKeyboard.clear();\n    }));\n    this.toUnhookForKeyboard.add(this.editor.onKeyDown(e => {\n      if (e) {\n        this.currentWordAtPosition = null;\n        this.removeLinkDecorations();\n        this.toUnhookForKeyboard.clear();\n      }\n    }));\n  }\n  startFindDefinitionFromMouse(mouseEvent, withKey) {\n    // check if we are active and on a content widget\n    if (mouseEvent.target.type === 9 /* MouseTargetType.CONTENT_WIDGET */ && this.linkDecorations.length > 0) {\n      return;\n    }\n    if (!this.editor.hasModel() || !this.isEnabled(mouseEvent, withKey)) {\n      this.currentWordAtPosition = null;\n      this.removeLinkDecorations();\n      return;\n    }\n    const position = mouseEvent.target.position;\n    this.startFindDefinition(position);\n  }\n  async startFindDefinition(position) {\n    var _a;\n    // Dispose listeners for updating decorations when using keyboard to show definition hover\n    this.toUnhookForKeyboard.clear();\n    // Find word at mouse position\n    const word = position ? (_a = this.editor.getModel()) === null || _a === void 0 ? void 0 : _a.getWordAtPosition(position) : null;\n    if (!word) {\n      this.currentWordAtPosition = null;\n      this.removeLinkDecorations();\n      return;\n    }\n    // Return early if word at position is still the same\n    if (this.currentWordAtPosition && this.currentWordAtPosition.startColumn === word.startColumn && this.currentWordAtPosition.endColumn === word.endColumn && this.currentWordAtPosition.word === word.word) {\n      return;\n    }\n    this.currentWordAtPosition = word;\n    // Find definition and decorate word if found\n    const state = new EditorState(this.editor, 4 /* CodeEditorStateFlag.Position */ | 1 /* CodeEditorStateFlag.Value */ | 2 /* CodeEditorStateFlag.Selection */ | 8 /* CodeEditorStateFlag.Scroll */);\n    if (this.previousPromise) {\n      this.previousPromise.cancel();\n      this.previousPromise = null;\n    }\n    this.previousPromise = createCancelablePromise(token => this.findDefinition(position, token));\n    let results;\n    try {\n      results = await this.previousPromise;\n    } catch (error) {\n      onUnexpectedError(error);\n      return;\n    }\n    if (!results || !results.length || !state.validate(this.editor)) {\n      this.removeLinkDecorations();\n      return;\n    }\n    const linkRange = results[0].originSelectionRange ? Range.lift(results[0].originSelectionRange) : new Range(position.lineNumber, word.startColumn, position.lineNumber, word.endColumn);\n    // Multiple results\n    if (results.length > 1) {\n      let combinedRange = linkRange;\n      for (const {\n        originSelectionRange\n      } of results) {\n        if (originSelectionRange) {\n          combinedRange = Range.plusRange(combinedRange, originSelectionRange);\n        }\n      }\n      this.addDecoration(combinedRange, new MarkdownString().appendText(nls.localize('multipleResults', \"Click to show {0} definitions.\", results.length)));\n    } else {\n      // Single result\n      const result = results[0];\n      if (!result.uri) {\n        return;\n      }\n      this.textModelResolverService.createModelReference(result.uri).then(ref => {\n        if (!ref.object || !ref.object.textEditorModel) {\n          ref.dispose();\n          return;\n        }\n        const {\n          object: {\n            textEditorModel\n          }\n        } = ref;\n        const {\n          startLineNumber\n        } = result.range;\n        if (startLineNumber < 1 || startLineNumber > textEditorModel.getLineCount()) {\n          // invalid range\n          ref.dispose();\n          return;\n        }\n        const previewValue = this.getPreviewValue(textEditorModel, startLineNumber, result);\n        const languageId = this.languageService.guessLanguageIdByFilepathOrFirstLine(textEditorModel.uri);\n        this.addDecoration(linkRange, previewValue ? new MarkdownString().appendCodeblock(languageId ? languageId : '', previewValue) : undefined);\n        ref.dispose();\n      });\n    }\n  }\n  getPreviewValue(textEditorModel, startLineNumber, result) {\n    let rangeToUse = result.range;\n    const numberOfLinesInRange = rangeToUse.endLineNumber - rangeToUse.startLineNumber;\n    if (numberOfLinesInRange >= GotoDefinitionAtPositionEditorContribution_1.MAX_SOURCE_PREVIEW_LINES) {\n      rangeToUse = this.getPreviewRangeBasedOnIndentation(textEditorModel, startLineNumber);\n    }\n    const previewValue = this.stripIndentationFromPreviewRange(textEditorModel, startLineNumber, rangeToUse);\n    return previewValue;\n  }\n  stripIndentationFromPreviewRange(textEditorModel, startLineNumber, previewRange) {\n    const startIndent = textEditorModel.getLineFirstNonWhitespaceColumn(startLineNumber);\n    let minIndent = startIndent;\n    for (let endLineNumber = startLineNumber + 1; endLineNumber < previewRange.endLineNumber; endLineNumber++) {\n      const endIndent = textEditorModel.getLineFirstNonWhitespaceColumn(endLineNumber);\n      minIndent = Math.min(minIndent, endIndent);\n    }\n    const previewValue = textEditorModel.getValueInRange(previewRange).replace(new RegExp(`^\\\\s{${minIndent - 1}}`, 'gm'), '').trim();\n    return previewValue;\n  }\n  getPreviewRangeBasedOnIndentation(textEditorModel, startLineNumber) {\n    const startIndent = textEditorModel.getLineFirstNonWhitespaceColumn(startLineNumber);\n    const maxLineNumber = Math.min(textEditorModel.getLineCount(), startLineNumber + GotoDefinitionAtPositionEditorContribution_1.MAX_SOURCE_PREVIEW_LINES);\n    let endLineNumber = startLineNumber + 1;\n    for (; endLineNumber < maxLineNumber; endLineNumber++) {\n      const endIndent = textEditorModel.getLineFirstNonWhitespaceColumn(endLineNumber);\n      if (startIndent === endIndent) {\n        break;\n      }\n    }\n    return new Range(startLineNumber, 1, endLineNumber + 1, 1);\n  }\n  addDecoration(range, hoverMessage) {\n    const newDecorations = {\n      range: range,\n      options: {\n        description: 'goto-definition-link',\n        inlineClassName: 'goto-definition-link',\n        hoverMessage\n      }\n    };\n    this.linkDecorations.set([newDecorations]);\n  }\n  removeLinkDecorations() {\n    this.linkDecorations.clear();\n  }\n  isEnabled(mouseEvent, withKey) {\n    var _a;\n    return this.editor.hasModel() && mouseEvent.isLeftClick && mouseEvent.isNoneOrSingleMouseDown && mouseEvent.target.type === 6 /* MouseTargetType.CONTENT_TEXT */ && !(((_a = mouseEvent.target.detail.injectedText) === null || _a === void 0 ? void 0 : _a.options) instanceof ModelDecorationInjectedTextOptions) && (mouseEvent.hasTriggerModifier || (withKey ? withKey.keyCodeIsTriggerKey : false)) && this.languageFeaturesService.definitionProvider.has(this.editor.getModel());\n  }\n  findDefinition(position, token) {\n    const model = this.editor.getModel();\n    if (!model) {\n      return Promise.resolve(null);\n    }\n    return getDefinitionsAtPosition(this.languageFeaturesService.definitionProvider, model, position, token);\n  }\n  gotoDefinition(position, openToSide) {\n    this.editor.setPosition(position);\n    return this.editor.invokeWithinContext(accessor => {\n      const canPeek = !openToSide && this.editor.getOption(87 /* EditorOption.definitionLinkOpensInPeek */) && !this.isInPeekEditor(accessor);\n      const action = new DefinitionAction({\n        openToSide,\n        openInPeek: canPeek,\n        muteMessage: true\n      }, {\n        title: {\n          value: '',\n          original: ''\n        },\n        id: '',\n        precondition: undefined\n      });\n      return action.run(accessor);\n    });\n  }\n  isInPeekEditor(accessor) {\n    const contextKeyService = accessor.get(IContextKeyService);\n    return PeekContext.inPeekEditor.getValue(contextKeyService);\n  }\n  dispose() {\n    this.toUnhook.dispose();\n    this.toUnhookForKeyboard.dispose();\n  }\n};\nGotoDefinitionAtPositionEditorContribution.ID = 'editor.contrib.gotodefinitionatposition';\nGotoDefinitionAtPositionEditorContribution.MAX_SOURCE_PREVIEW_LINES = 8;\nGotoDefinitionAtPositionEditorContribution = GotoDefinitionAtPositionEditorContribution_1 = __decorate([__param(1, ITextModelService), __param(2, ILanguageService), __param(3, ILanguageFeaturesService)], GotoDefinitionAtPositionEditorContribution);\nexport { GotoDefinitionAtPositionEditorContribution };\nregisterEditorContribution(GotoDefinitionAtPositionEditorContribution.ID, GotoDefinitionAtPositionEditorContribution, 2 /* EditorContributionInstantiation.BeforeFirstInteraction */);","map":{"version":3,"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","GotoDefinitionAtPositionEditorContribution_1","createCancelablePromise","onUnexpectedError","MarkdownString","DisposableStore","EditorState","registerEditorContribution","Range","ILanguageService","ITextModelService","ClickLinkGesture","PeekContext","nls","IContextKeyService","DefinitionAction","getDefinitionsAtPosition","ILanguageFeaturesService","ModelDecorationInjectedTextOptions","GotoDefinitionAtPositionEditorContribution","constructor","editor","textModelResolverService","languageService","languageFeaturesService","toUnhook","toUnhookForKeyboard","currentWordAtPosition","previousPromise","linkDecorations","createDecorationsCollection","linkGesture","add","onMouseMoveOrRelevantKeyDown","mouseEvent","keyboardEvent","startFindDefinitionFromMouse","undefined","onExecute","isEnabled","gotoDefinition","position","hasSideBySideModifier","catch","error","finally","removeLinkDecorations","onCancel","get","getContribution","ID","startFindDefinitionFromCursor","startFindDefinition","onDidChangeCursorPosition","clear","onKeyDown","e","withKey","type","hasModel","_a","word","getModel","getWordAtPosition","startColumn","endColumn","state","cancel","token","findDefinition","results","validate","linkRange","originSelectionRange","lift","lineNumber","combinedRange","plusRange","addDecoration","appendText","localize","result","uri","createModelReference","then","ref","object","textEditorModel","dispose","startLineNumber","range","getLineCount","previewValue","getPreviewValue","languageId","guessLanguageIdByFilepathOrFirstLine","appendCodeblock","rangeToUse","numberOfLinesInRange","endLineNumber","MAX_SOURCE_PREVIEW_LINES","getPreviewRangeBasedOnIndentation","stripIndentationFromPreviewRange","previewRange","startIndent","getLineFirstNonWhitespaceColumn","minIndent","endIndent","Math","min","getValueInRange","replace","RegExp","trim","maxLineNumber","hoverMessage","newDecorations","options","description","inlineClassName","set","isLeftClick","isNoneOrSingleMouseDown","detail","injectedText","hasTriggerModifier","keyCodeIsTriggerKey","definitionProvider","has","model","Promise","resolve","openToSide","setPosition","invokeWithinContext","accessor","canPeek","getOption","isInPeekEditor","action","openInPeek","muteMessage","title","value","original","id","precondition","run","contextKeyService","inPeekEditor","getValue"],"sources":["/Users/zj/projects/zjoj/zjoj-frontend/node_modules/monaco-editor/esm/vs/editor/contrib/gotoSymbol/browser/link/goToDefinitionAtPosition.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nvar GotoDefinitionAtPositionEditorContribution_1;\nimport { createCancelablePromise } from '../../../../../base/common/async.js';\nimport { onUnexpectedError } from '../../../../../base/common/errors.js';\nimport { MarkdownString } from '../../../../../base/common/htmlContent.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport './goToDefinitionAtPosition.css';\nimport { EditorState } from '../../../editorState/browser/editorState.js';\nimport { registerEditorContribution } from '../../../../browser/editorExtensions.js';\nimport { Range } from '../../../../common/core/range.js';\nimport { ILanguageService } from '../../../../common/languages/language.js';\nimport { ITextModelService } from '../../../../common/services/resolverService.js';\nimport { ClickLinkGesture } from './clickLinkGesture.js';\nimport { PeekContext } from '../../../peekView/browser/peekView.js';\nimport * as nls from '../../../../../nls.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { DefinitionAction } from '../goToCommands.js';\nimport { getDefinitionsAtPosition } from '../goToSymbol.js';\nimport { ILanguageFeaturesService } from '../../../../common/services/languageFeatures.js';\nimport { ModelDecorationInjectedTextOptions } from '../../../../common/model/textModel.js';\nlet GotoDefinitionAtPositionEditorContribution = GotoDefinitionAtPositionEditorContribution_1 = class GotoDefinitionAtPositionEditorContribution {\n    constructor(editor, textModelResolverService, languageService, languageFeaturesService) {\n        this.textModelResolverService = textModelResolverService;\n        this.languageService = languageService;\n        this.languageFeaturesService = languageFeaturesService;\n        this.toUnhook = new DisposableStore();\n        this.toUnhookForKeyboard = new DisposableStore();\n        this.currentWordAtPosition = null;\n        this.previousPromise = null;\n        this.editor = editor;\n        this.linkDecorations = this.editor.createDecorationsCollection();\n        const linkGesture = new ClickLinkGesture(editor);\n        this.toUnhook.add(linkGesture);\n        this.toUnhook.add(linkGesture.onMouseMoveOrRelevantKeyDown(([mouseEvent, keyboardEvent]) => {\n            this.startFindDefinitionFromMouse(mouseEvent, keyboardEvent !== null && keyboardEvent !== void 0 ? keyboardEvent : undefined);\n        }));\n        this.toUnhook.add(linkGesture.onExecute((mouseEvent) => {\n            if (this.isEnabled(mouseEvent)) {\n                this.gotoDefinition(mouseEvent.target.position, mouseEvent.hasSideBySideModifier)\n                    .catch((error) => {\n                    onUnexpectedError(error);\n                })\n                    .finally(() => {\n                    this.removeLinkDecorations();\n                });\n            }\n        }));\n        this.toUnhook.add(linkGesture.onCancel(() => {\n            this.removeLinkDecorations();\n            this.currentWordAtPosition = null;\n        }));\n    }\n    static get(editor) {\n        return editor.getContribution(GotoDefinitionAtPositionEditorContribution_1.ID);\n    }\n    async startFindDefinitionFromCursor(position) {\n        // For issue: https://github.com/microsoft/vscode/issues/46257\n        // equivalent to mouse move with meta/ctrl key\n        // First find the definition and add decorations\n        // to the editor to be shown with the content hover widget\n        await this.startFindDefinition(position);\n        // Add listeners for editor cursor move and key down events\n        // Dismiss the \"extended\" editor decorations when the user hides\n        // the hover widget. There is no event for the widget itself so these\n        // serve as a best effort. After removing the link decorations, the hover\n        // widget is clean and will only show declarations per next request.\n        this.toUnhookForKeyboard.add(this.editor.onDidChangeCursorPosition(() => {\n            this.currentWordAtPosition = null;\n            this.removeLinkDecorations();\n            this.toUnhookForKeyboard.clear();\n        }));\n        this.toUnhookForKeyboard.add(this.editor.onKeyDown((e) => {\n            if (e) {\n                this.currentWordAtPosition = null;\n                this.removeLinkDecorations();\n                this.toUnhookForKeyboard.clear();\n            }\n        }));\n    }\n    startFindDefinitionFromMouse(mouseEvent, withKey) {\n        // check if we are active and on a content widget\n        if (mouseEvent.target.type === 9 /* MouseTargetType.CONTENT_WIDGET */ && this.linkDecorations.length > 0) {\n            return;\n        }\n        if (!this.editor.hasModel() || !this.isEnabled(mouseEvent, withKey)) {\n            this.currentWordAtPosition = null;\n            this.removeLinkDecorations();\n            return;\n        }\n        const position = mouseEvent.target.position;\n        this.startFindDefinition(position);\n    }\n    async startFindDefinition(position) {\n        var _a;\n        // Dispose listeners for updating decorations when using keyboard to show definition hover\n        this.toUnhookForKeyboard.clear();\n        // Find word at mouse position\n        const word = position ? (_a = this.editor.getModel()) === null || _a === void 0 ? void 0 : _a.getWordAtPosition(position) : null;\n        if (!word) {\n            this.currentWordAtPosition = null;\n            this.removeLinkDecorations();\n            return;\n        }\n        // Return early if word at position is still the same\n        if (this.currentWordAtPosition && this.currentWordAtPosition.startColumn === word.startColumn && this.currentWordAtPosition.endColumn === word.endColumn && this.currentWordAtPosition.word === word.word) {\n            return;\n        }\n        this.currentWordAtPosition = word;\n        // Find definition and decorate word if found\n        const state = new EditorState(this.editor, 4 /* CodeEditorStateFlag.Position */ | 1 /* CodeEditorStateFlag.Value */ | 2 /* CodeEditorStateFlag.Selection */ | 8 /* CodeEditorStateFlag.Scroll */);\n        if (this.previousPromise) {\n            this.previousPromise.cancel();\n            this.previousPromise = null;\n        }\n        this.previousPromise = createCancelablePromise(token => this.findDefinition(position, token));\n        let results;\n        try {\n            results = await this.previousPromise;\n        }\n        catch (error) {\n            onUnexpectedError(error);\n            return;\n        }\n        if (!results || !results.length || !state.validate(this.editor)) {\n            this.removeLinkDecorations();\n            return;\n        }\n        const linkRange = results[0].originSelectionRange\n            ? Range.lift(results[0].originSelectionRange)\n            : new Range(position.lineNumber, word.startColumn, position.lineNumber, word.endColumn);\n        // Multiple results\n        if (results.length > 1) {\n            let combinedRange = linkRange;\n            for (const { originSelectionRange } of results) {\n                if (originSelectionRange) {\n                    combinedRange = Range.plusRange(combinedRange, originSelectionRange);\n                }\n            }\n            this.addDecoration(combinedRange, new MarkdownString().appendText(nls.localize('multipleResults', \"Click to show {0} definitions.\", results.length)));\n        }\n        else {\n            // Single result\n            const result = results[0];\n            if (!result.uri) {\n                return;\n            }\n            this.textModelResolverService.createModelReference(result.uri).then(ref => {\n                if (!ref.object || !ref.object.textEditorModel) {\n                    ref.dispose();\n                    return;\n                }\n                const { object: { textEditorModel } } = ref;\n                const { startLineNumber } = result.range;\n                if (startLineNumber < 1 || startLineNumber > textEditorModel.getLineCount()) {\n                    // invalid range\n                    ref.dispose();\n                    return;\n                }\n                const previewValue = this.getPreviewValue(textEditorModel, startLineNumber, result);\n                const languageId = this.languageService.guessLanguageIdByFilepathOrFirstLine(textEditorModel.uri);\n                this.addDecoration(linkRange, previewValue ? new MarkdownString().appendCodeblock(languageId ? languageId : '', previewValue) : undefined);\n                ref.dispose();\n            });\n        }\n    }\n    getPreviewValue(textEditorModel, startLineNumber, result) {\n        let rangeToUse = result.range;\n        const numberOfLinesInRange = rangeToUse.endLineNumber - rangeToUse.startLineNumber;\n        if (numberOfLinesInRange >= GotoDefinitionAtPositionEditorContribution_1.MAX_SOURCE_PREVIEW_LINES) {\n            rangeToUse = this.getPreviewRangeBasedOnIndentation(textEditorModel, startLineNumber);\n        }\n        const previewValue = this.stripIndentationFromPreviewRange(textEditorModel, startLineNumber, rangeToUse);\n        return previewValue;\n    }\n    stripIndentationFromPreviewRange(textEditorModel, startLineNumber, previewRange) {\n        const startIndent = textEditorModel.getLineFirstNonWhitespaceColumn(startLineNumber);\n        let minIndent = startIndent;\n        for (let endLineNumber = startLineNumber + 1; endLineNumber < previewRange.endLineNumber; endLineNumber++) {\n            const endIndent = textEditorModel.getLineFirstNonWhitespaceColumn(endLineNumber);\n            minIndent = Math.min(minIndent, endIndent);\n        }\n        const previewValue = textEditorModel.getValueInRange(previewRange).replace(new RegExp(`^\\\\s{${minIndent - 1}}`, 'gm'), '').trim();\n        return previewValue;\n    }\n    getPreviewRangeBasedOnIndentation(textEditorModel, startLineNumber) {\n        const startIndent = textEditorModel.getLineFirstNonWhitespaceColumn(startLineNumber);\n        const maxLineNumber = Math.min(textEditorModel.getLineCount(), startLineNumber + GotoDefinitionAtPositionEditorContribution_1.MAX_SOURCE_PREVIEW_LINES);\n        let endLineNumber = startLineNumber + 1;\n        for (; endLineNumber < maxLineNumber; endLineNumber++) {\n            const endIndent = textEditorModel.getLineFirstNonWhitespaceColumn(endLineNumber);\n            if (startIndent === endIndent) {\n                break;\n            }\n        }\n        return new Range(startLineNumber, 1, endLineNumber + 1, 1);\n    }\n    addDecoration(range, hoverMessage) {\n        const newDecorations = {\n            range: range,\n            options: {\n                description: 'goto-definition-link',\n                inlineClassName: 'goto-definition-link',\n                hoverMessage\n            }\n        };\n        this.linkDecorations.set([newDecorations]);\n    }\n    removeLinkDecorations() {\n        this.linkDecorations.clear();\n    }\n    isEnabled(mouseEvent, withKey) {\n        var _a;\n        return this.editor.hasModel()\n            && mouseEvent.isLeftClick\n            && mouseEvent.isNoneOrSingleMouseDown\n            && mouseEvent.target.type === 6 /* MouseTargetType.CONTENT_TEXT */\n            && !(((_a = mouseEvent.target.detail.injectedText) === null || _a === void 0 ? void 0 : _a.options) instanceof ModelDecorationInjectedTextOptions)\n            && (mouseEvent.hasTriggerModifier || (withKey ? withKey.keyCodeIsTriggerKey : false))\n            && this.languageFeaturesService.definitionProvider.has(this.editor.getModel());\n    }\n    findDefinition(position, token) {\n        const model = this.editor.getModel();\n        if (!model) {\n            return Promise.resolve(null);\n        }\n        return getDefinitionsAtPosition(this.languageFeaturesService.definitionProvider, model, position, token);\n    }\n    gotoDefinition(position, openToSide) {\n        this.editor.setPosition(position);\n        return this.editor.invokeWithinContext((accessor) => {\n            const canPeek = !openToSide && this.editor.getOption(87 /* EditorOption.definitionLinkOpensInPeek */) && !this.isInPeekEditor(accessor);\n            const action = new DefinitionAction({ openToSide, openInPeek: canPeek, muteMessage: true }, { title: { value: '', original: '' }, id: '', precondition: undefined });\n            return action.run(accessor);\n        });\n    }\n    isInPeekEditor(accessor) {\n        const contextKeyService = accessor.get(IContextKeyService);\n        return PeekContext.inPeekEditor.getValue(contextKeyService);\n    }\n    dispose() {\n        this.toUnhook.dispose();\n        this.toUnhookForKeyboard.dispose();\n    }\n};\nGotoDefinitionAtPositionEditorContribution.ID = 'editor.contrib.gotodefinitionatposition';\nGotoDefinitionAtPositionEditorContribution.MAX_SOURCE_PREVIEW_LINES = 8;\nGotoDefinitionAtPositionEditorContribution = GotoDefinitionAtPositionEditorContribution_1 = __decorate([\n    __param(1, ITextModelService),\n    __param(2, ILanguageService),\n    __param(3, ILanguageFeaturesService)\n], GotoDefinitionAtPositionEditorContribution);\nexport { GotoDefinitionAtPositionEditorContribution };\nregisterEditorContribution(GotoDefinitionAtPositionEditorContribution.ID, GotoDefinitionAtPositionEditorContribution, 2 /* EditorContributionInstantiation.BeforeFirstInteraction */);\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}