{"ast":null,"code":"import { ref, watch, onMounted, onBeforeUnmount, readonly } from \"vue\";\nconst POPUP_BASE_Z_INDEX = 1e3;\nconst MESSAGE_BASE_Z_INDEX = 5e3;\nconst Z_INDEX_STEP = 1;\nclass PopupManager {\n  constructor() {\n    this.popupStack = {\n      popup: new Set(),\n      dialog: new Set(),\n      message: new Set()\n    };\n    this.getNextZIndex = type => {\n      const current = type === \"message\" ? Array.from(this.popupStack.message).pop() || MESSAGE_BASE_Z_INDEX : Array.from(this.popupStack.popup).pop() || POPUP_BASE_Z_INDEX;\n      return current + Z_INDEX_STEP;\n    };\n    this.add = type => {\n      const zIndex = this.getNextZIndex(type);\n      this.popupStack[type].add(zIndex);\n      if (type === \"dialog\") {\n        this.popupStack.popup.add(zIndex);\n      }\n      return zIndex;\n    };\n    this.delete = (zIndex, type) => {\n      this.popupStack[type].delete(zIndex);\n      if (type === \"dialog\") {\n        this.popupStack.popup.delete(zIndex);\n      }\n    };\n    this.isLastDialog = zIndex => {\n      if (this.popupStack.dialog.size > 1) {\n        return zIndex === Array.from(this.popupStack.dialog).pop();\n      }\n      return true;\n    };\n  }\n}\nconst popupManager = new PopupManager();\nfunction usePopupManager(type, {\n  visible,\n  runOnMounted\n} = {}) {\n  const zIndex = ref(0);\n  const open = () => {\n    zIndex.value = popupManager.add(type);\n  };\n  const close = () => {\n    popupManager.delete(zIndex.value, type);\n  };\n  const isLastDialog = () => {\n    if (type === \"dialog\") {\n      return popupManager.isLastDialog(zIndex.value);\n    }\n    return false;\n  };\n  watch(() => visible == null ? void 0 : visible.value, visible2 => {\n    if (visible2) {\n      open();\n    } else {\n      close();\n    }\n  }, {\n    immediate: true\n  });\n  if (runOnMounted) {\n    onMounted(() => {\n      open();\n    });\n    onBeforeUnmount(() => {\n      close();\n    });\n  }\n  return {\n    zIndex: readonly(zIndex),\n    open,\n    close,\n    isLastDialog\n  };\n}\nexport { usePopupManager as default };","map":{"version":3,"names":["ref","watch","onMounted","onBeforeUnmount","readonly","POPUP_BASE_Z_INDEX","MESSAGE_BASE_Z_INDEX","Z_INDEX_STEP","PopupManager","constructor","popupStack","popup","Set","dialog","message","getNextZIndex","type","current","Array","from","pop","add","zIndex","delete","isLastDialog","size","popupManager","usePopupManager","visible","runOnMounted","open","value","close","visible2","immediate","default"],"sources":["/Users/zj/projects/zjoj/zjoj-frontend/node_modules/@arco-design/web-vue/es/_hooks/use-popup-manager.js"],"sourcesContent":["import { ref, watch, onMounted, onBeforeUnmount, readonly } from \"vue\";\nconst POPUP_BASE_Z_INDEX = 1e3;\nconst MESSAGE_BASE_Z_INDEX = 5e3;\nconst Z_INDEX_STEP = 1;\nclass PopupManager {\n  constructor() {\n    this.popupStack = {\n      popup: new Set(),\n      dialog: new Set(),\n      message: new Set()\n    };\n    this.getNextZIndex = (type) => {\n      const current = type === \"message\" ? Array.from(this.popupStack.message).pop() || MESSAGE_BASE_Z_INDEX : Array.from(this.popupStack.popup).pop() || POPUP_BASE_Z_INDEX;\n      return current + Z_INDEX_STEP;\n    };\n    this.add = (type) => {\n      const zIndex = this.getNextZIndex(type);\n      this.popupStack[type].add(zIndex);\n      if (type === \"dialog\") {\n        this.popupStack.popup.add(zIndex);\n      }\n      return zIndex;\n    };\n    this.delete = (zIndex, type) => {\n      this.popupStack[type].delete(zIndex);\n      if (type === \"dialog\") {\n        this.popupStack.popup.delete(zIndex);\n      }\n    };\n    this.isLastDialog = (zIndex) => {\n      if (this.popupStack.dialog.size > 1) {\n        return zIndex === Array.from(this.popupStack.dialog).pop();\n      }\n      return true;\n    };\n  }\n}\nconst popupManager = new PopupManager();\nfunction usePopupManager(type, {\n  visible,\n  runOnMounted\n} = {}) {\n  const zIndex = ref(0);\n  const open = () => {\n    zIndex.value = popupManager.add(type);\n  };\n  const close = () => {\n    popupManager.delete(zIndex.value, type);\n  };\n  const isLastDialog = () => {\n    if (type === \"dialog\") {\n      return popupManager.isLastDialog(zIndex.value);\n    }\n    return false;\n  };\n  watch(() => visible == null ? void 0 : visible.value, (visible2) => {\n    if (visible2) {\n      open();\n    } else {\n      close();\n    }\n  }, {\n    immediate: true\n  });\n  if (runOnMounted) {\n    onMounted(() => {\n      open();\n    });\n    onBeforeUnmount(() => {\n      close();\n    });\n  }\n  return {\n    zIndex: readonly(zIndex),\n    open,\n    close,\n    isLastDialog\n  };\n}\nexport { usePopupManager as default };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}