{"ast":null,"code":"import { toRefs, ref, watchEffect, watch, nextTick } from \"vue\";\nimport { on, off } from \"../../_utils/dom.js\";\nimport getFixTranslate from \"../utils/get-fix-translate.js\";\nfunction useImageDrag(props) {\n  const {\n    wrapperEl,\n    imageEl,\n    scale\n  } = toRefs(props);\n  const translate = ref([0, 0]);\n  const moving = ref(false);\n  let startPageX = 0;\n  let startPageY = 0;\n  let startTranslate = [0, 0];\n  const checkAndFixTranslate = () => {\n    if (!wrapperEl.value || !imageEl.value) return;\n    const wrapperRect = wrapperEl.value.getBoundingClientRect();\n    const imgRect = imageEl.value.getBoundingClientRect();\n    const [x, y] = getFixTranslate(wrapperRect, imgRect, translate.value[0], translate.value[1], scale.value);\n    if (x !== translate.value[0] || y !== translate.value[1]) {\n      translate.value = [x, y];\n    }\n  };\n  const onMoving = e => {\n    e.preventDefault && e.preventDefault();\n    const nextX = startTranslate[0] + (e.pageX - startPageX) / scale.value;\n    const nextY = startTranslate[1] + (e.pageY - startPageY) / scale.value;\n    translate.value = [nextX, nextY];\n  };\n  const onMoveEnd = e => {\n    e.preventDefault && e.preventDefault();\n    moving.value = false;\n    checkAndFixTranslate();\n    offEvents();\n  };\n  const onMoveStart = e => {\n    if (e.target !== e.currentTarget) return;\n    e.preventDefault && e.preventDefault();\n    moving.value = true;\n    startPageX = e.pageX;\n    startPageY = e.pageY;\n    startTranslate = [...translate.value];\n    on(window, \"mousemove\", onMoving, false);\n    on(window, \"mouseup\", onMoveEnd, false);\n  };\n  function offEvents() {\n    off(window, \"mousemove\", onMoving, false);\n    off(window, \"mouseup\", onMoveEnd, false);\n  }\n  watchEffect(onInvalidate => {\n    imageEl.value && on(imageEl.value, \"mousedown\", onMoveStart);\n    onInvalidate(() => {\n      imageEl.value && off(imageEl.value, \"mousedown\", onMoveStart);\n      offEvents();\n    });\n  });\n  watch([scale], () => {\n    nextTick(() => checkAndFixTranslate());\n  });\n  return {\n    translate,\n    moving,\n    resetTranslate() {\n      translate.value = [0, 0];\n    }\n  };\n}\nexport { useImageDrag as default };","map":{"version":3,"names":["toRefs","ref","watchEffect","watch","nextTick","on","off","getFixTranslate","useImageDrag","props","wrapperEl","imageEl","scale","translate","moving","startPageX","startPageY","startTranslate","checkAndFixTranslate","value","wrapperRect","getBoundingClientRect","imgRect","x","y","onMoving","e","preventDefault","nextX","pageX","nextY","pageY","onMoveEnd","offEvents","onMoveStart","target","currentTarget","window","onInvalidate","resetTranslate","default"],"sources":["/Users/zj/projects/zjoj/zjoj-frontend/node_modules/@arco-design/web-vue/es/image/hooks/use-image-drag.js"],"sourcesContent":["import { toRefs, ref, watchEffect, watch, nextTick } from \"vue\";\nimport { on, off } from \"../../_utils/dom.js\";\nimport getFixTranslate from \"../utils/get-fix-translate.js\";\nfunction useImageDrag(props) {\n  const { wrapperEl, imageEl, scale } = toRefs(props);\n  const translate = ref([0, 0]);\n  const moving = ref(false);\n  let startPageX = 0;\n  let startPageY = 0;\n  let startTranslate = [0, 0];\n  const checkAndFixTranslate = () => {\n    if (!wrapperEl.value || !imageEl.value)\n      return;\n    const wrapperRect = wrapperEl.value.getBoundingClientRect();\n    const imgRect = imageEl.value.getBoundingClientRect();\n    const [x, y] = getFixTranslate(wrapperRect, imgRect, translate.value[0], translate.value[1], scale.value);\n    if (x !== translate.value[0] || y !== translate.value[1]) {\n      translate.value = [x, y];\n    }\n  };\n  const onMoving = (e) => {\n    e.preventDefault && e.preventDefault();\n    const nextX = startTranslate[0] + (e.pageX - startPageX) / scale.value;\n    const nextY = startTranslate[1] + (e.pageY - startPageY) / scale.value;\n    translate.value = [nextX, nextY];\n  };\n  const onMoveEnd = (e) => {\n    e.preventDefault && e.preventDefault();\n    moving.value = false;\n    checkAndFixTranslate();\n    offEvents();\n  };\n  const onMoveStart = (e) => {\n    if (e.target !== e.currentTarget)\n      return;\n    e.preventDefault && e.preventDefault();\n    moving.value = true;\n    startPageX = e.pageX;\n    startPageY = e.pageY;\n    startTranslate = [...translate.value];\n    on(window, \"mousemove\", onMoving, false);\n    on(window, \"mouseup\", onMoveEnd, false);\n  };\n  function offEvents() {\n    off(window, \"mousemove\", onMoving, false);\n    off(window, \"mouseup\", onMoveEnd, false);\n  }\n  watchEffect((onInvalidate) => {\n    imageEl.value && on(imageEl.value, \"mousedown\", onMoveStart);\n    onInvalidate(() => {\n      imageEl.value && off(imageEl.value, \"mousedown\", onMoveStart);\n      offEvents();\n    });\n  });\n  watch([scale], () => {\n    nextTick(() => checkAndFixTranslate());\n  });\n  return {\n    translate,\n    moving,\n    resetTranslate() {\n      translate.value = [0, 0];\n    }\n  };\n}\nexport { useImageDrag as default };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}