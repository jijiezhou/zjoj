{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { createFastDomNode } from '../../../../base/browser/fastDomNode.js';\nimport { OverviewZoneManager } from '../../../common/viewModel/overviewZoneManager.js';\nimport { ViewEventHandler } from '../../../common/viewEventHandler.js';\nexport class OverviewRuler extends ViewEventHandler {\n  constructor(context, cssClassName) {\n    super();\n    this._context = context;\n    const options = this._context.configuration.options;\n    this._domNode = createFastDomNode(document.createElement('canvas'));\n    this._domNode.setClassName(cssClassName);\n    this._domNode.setPosition('absolute');\n    this._domNode.setLayerHinting(true);\n    this._domNode.setContain('strict');\n    this._zoneManager = new OverviewZoneManager(lineNumber => this._context.viewLayout.getVerticalOffsetForLineNumber(lineNumber));\n    this._zoneManager.setDOMWidth(0);\n    this._zoneManager.setDOMHeight(0);\n    this._zoneManager.setOuterHeight(this._context.viewLayout.getScrollHeight());\n    this._zoneManager.setLineHeight(options.get(66 /* EditorOption.lineHeight */));\n    this._zoneManager.setPixelRatio(options.get(141 /* EditorOption.pixelRatio */));\n    this._context.addEventHandler(this);\n  }\n  dispose() {\n    this._context.removeEventHandler(this);\n    super.dispose();\n  }\n  // ---- begin view event handlers\n  onConfigurationChanged(e) {\n    const options = this._context.configuration.options;\n    if (e.hasChanged(66 /* EditorOption.lineHeight */)) {\n      this._zoneManager.setLineHeight(options.get(66 /* EditorOption.lineHeight */));\n      this._render();\n    }\n    if (e.hasChanged(141 /* EditorOption.pixelRatio */)) {\n      this._zoneManager.setPixelRatio(options.get(141 /* EditorOption.pixelRatio */));\n      this._domNode.setWidth(this._zoneManager.getDOMWidth());\n      this._domNode.setHeight(this._zoneManager.getDOMHeight());\n      this._domNode.domNode.width = this._zoneManager.getCanvasWidth();\n      this._domNode.domNode.height = this._zoneManager.getCanvasHeight();\n      this._render();\n    }\n    return true;\n  }\n  onFlushed(e) {\n    this._render();\n    return true;\n  }\n  onScrollChanged(e) {\n    if (e.scrollHeightChanged) {\n      this._zoneManager.setOuterHeight(e.scrollHeight);\n      this._render();\n    }\n    return true;\n  }\n  onZonesChanged(e) {\n    this._render();\n    return true;\n  }\n  // ---- end view event handlers\n  getDomNode() {\n    return this._domNode.domNode;\n  }\n  setLayout(position) {\n    this._domNode.setTop(position.top);\n    this._domNode.setRight(position.right);\n    let hasChanged = false;\n    hasChanged = this._zoneManager.setDOMWidth(position.width) || hasChanged;\n    hasChanged = this._zoneManager.setDOMHeight(position.height) || hasChanged;\n    if (hasChanged) {\n      this._domNode.setWidth(this._zoneManager.getDOMWidth());\n      this._domNode.setHeight(this._zoneManager.getDOMHeight());\n      this._domNode.domNode.width = this._zoneManager.getCanvasWidth();\n      this._domNode.domNode.height = this._zoneManager.getCanvasHeight();\n      this._render();\n    }\n  }\n  setZones(zones) {\n    this._zoneManager.setZones(zones);\n    this._render();\n  }\n  _render() {\n    if (this._zoneManager.getOuterHeight() === 0) {\n      return false;\n    }\n    const width = this._zoneManager.getCanvasWidth();\n    const height = this._zoneManager.getCanvasHeight();\n    const colorZones = this._zoneManager.resolveColorZones();\n    const id2Color = this._zoneManager.getId2Color();\n    const ctx = this._domNode.domNode.getContext('2d');\n    ctx.clearRect(0, 0, width, height);\n    if (colorZones.length > 0) {\n      this._renderOneLane(ctx, colorZones, id2Color, width);\n    }\n    return true;\n  }\n  _renderOneLane(ctx, colorZones, id2Color, width) {\n    let currentColorId = 0;\n    let currentFrom = 0;\n    let currentTo = 0;\n    for (const zone of colorZones) {\n      const zoneColorId = zone.colorId;\n      const zoneFrom = zone.from;\n      const zoneTo = zone.to;\n      if (zoneColorId !== currentColorId) {\n        ctx.fillRect(0, currentFrom, width, currentTo - currentFrom);\n        currentColorId = zoneColorId;\n        ctx.fillStyle = id2Color[currentColorId];\n        currentFrom = zoneFrom;\n        currentTo = zoneTo;\n      } else {\n        if (currentTo >= zoneFrom) {\n          currentTo = Math.max(currentTo, zoneTo);\n        } else {\n          ctx.fillRect(0, currentFrom, width, currentTo - currentFrom);\n          currentFrom = zoneFrom;\n          currentTo = zoneTo;\n        }\n      }\n    }\n    ctx.fillRect(0, currentFrom, width, currentTo - currentFrom);\n  }\n}","map":{"version":3,"names":["createFastDomNode","OverviewZoneManager","ViewEventHandler","OverviewRuler","constructor","context","cssClassName","_context","options","configuration","_domNode","document","createElement","setClassName","setPosition","setLayerHinting","setContain","_zoneManager","lineNumber","viewLayout","getVerticalOffsetForLineNumber","setDOMWidth","setDOMHeight","setOuterHeight","getScrollHeight","setLineHeight","get","setPixelRatio","addEventHandler","dispose","removeEventHandler","onConfigurationChanged","e","hasChanged","_render","setWidth","getDOMWidth","setHeight","getDOMHeight","domNode","width","getCanvasWidth","height","getCanvasHeight","onFlushed","onScrollChanged","scrollHeightChanged","scrollHeight","onZonesChanged","getDomNode","setLayout","position","setTop","top","setRight","right","setZones","zones","getOuterHeight","colorZones","resolveColorZones","id2Color","getId2Color","ctx","getContext","clearRect","length","_renderOneLane","currentColorId","currentFrom","currentTo","zone","zoneColorId","colorId","zoneFrom","from","zoneTo","to","fillRect","fillStyle","Math","max"],"sources":["/Users/zj/projects/zjoj/zjoj-frontend/node_modules/monaco-editor/esm/vs/editor/browser/viewParts/overviewRuler/overviewRuler.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { createFastDomNode } from '../../../../base/browser/fastDomNode.js';\nimport { OverviewZoneManager } from '../../../common/viewModel/overviewZoneManager.js';\nimport { ViewEventHandler } from '../../../common/viewEventHandler.js';\nexport class OverviewRuler extends ViewEventHandler {\n    constructor(context, cssClassName) {\n        super();\n        this._context = context;\n        const options = this._context.configuration.options;\n        this._domNode = createFastDomNode(document.createElement('canvas'));\n        this._domNode.setClassName(cssClassName);\n        this._domNode.setPosition('absolute');\n        this._domNode.setLayerHinting(true);\n        this._domNode.setContain('strict');\n        this._zoneManager = new OverviewZoneManager((lineNumber) => this._context.viewLayout.getVerticalOffsetForLineNumber(lineNumber));\n        this._zoneManager.setDOMWidth(0);\n        this._zoneManager.setDOMHeight(0);\n        this._zoneManager.setOuterHeight(this._context.viewLayout.getScrollHeight());\n        this._zoneManager.setLineHeight(options.get(66 /* EditorOption.lineHeight */));\n        this._zoneManager.setPixelRatio(options.get(141 /* EditorOption.pixelRatio */));\n        this._context.addEventHandler(this);\n    }\n    dispose() {\n        this._context.removeEventHandler(this);\n        super.dispose();\n    }\n    // ---- begin view event handlers\n    onConfigurationChanged(e) {\n        const options = this._context.configuration.options;\n        if (e.hasChanged(66 /* EditorOption.lineHeight */)) {\n            this._zoneManager.setLineHeight(options.get(66 /* EditorOption.lineHeight */));\n            this._render();\n        }\n        if (e.hasChanged(141 /* EditorOption.pixelRatio */)) {\n            this._zoneManager.setPixelRatio(options.get(141 /* EditorOption.pixelRatio */));\n            this._domNode.setWidth(this._zoneManager.getDOMWidth());\n            this._domNode.setHeight(this._zoneManager.getDOMHeight());\n            this._domNode.domNode.width = this._zoneManager.getCanvasWidth();\n            this._domNode.domNode.height = this._zoneManager.getCanvasHeight();\n            this._render();\n        }\n        return true;\n    }\n    onFlushed(e) {\n        this._render();\n        return true;\n    }\n    onScrollChanged(e) {\n        if (e.scrollHeightChanged) {\n            this._zoneManager.setOuterHeight(e.scrollHeight);\n            this._render();\n        }\n        return true;\n    }\n    onZonesChanged(e) {\n        this._render();\n        return true;\n    }\n    // ---- end view event handlers\n    getDomNode() {\n        return this._domNode.domNode;\n    }\n    setLayout(position) {\n        this._domNode.setTop(position.top);\n        this._domNode.setRight(position.right);\n        let hasChanged = false;\n        hasChanged = this._zoneManager.setDOMWidth(position.width) || hasChanged;\n        hasChanged = this._zoneManager.setDOMHeight(position.height) || hasChanged;\n        if (hasChanged) {\n            this._domNode.setWidth(this._zoneManager.getDOMWidth());\n            this._domNode.setHeight(this._zoneManager.getDOMHeight());\n            this._domNode.domNode.width = this._zoneManager.getCanvasWidth();\n            this._domNode.domNode.height = this._zoneManager.getCanvasHeight();\n            this._render();\n        }\n    }\n    setZones(zones) {\n        this._zoneManager.setZones(zones);\n        this._render();\n    }\n    _render() {\n        if (this._zoneManager.getOuterHeight() === 0) {\n            return false;\n        }\n        const width = this._zoneManager.getCanvasWidth();\n        const height = this._zoneManager.getCanvasHeight();\n        const colorZones = this._zoneManager.resolveColorZones();\n        const id2Color = this._zoneManager.getId2Color();\n        const ctx = this._domNode.domNode.getContext('2d');\n        ctx.clearRect(0, 0, width, height);\n        if (colorZones.length > 0) {\n            this._renderOneLane(ctx, colorZones, id2Color, width);\n        }\n        return true;\n    }\n    _renderOneLane(ctx, colorZones, id2Color, width) {\n        let currentColorId = 0;\n        let currentFrom = 0;\n        let currentTo = 0;\n        for (const zone of colorZones) {\n            const zoneColorId = zone.colorId;\n            const zoneFrom = zone.from;\n            const zoneTo = zone.to;\n            if (zoneColorId !== currentColorId) {\n                ctx.fillRect(0, currentFrom, width, currentTo - currentFrom);\n                currentColorId = zoneColorId;\n                ctx.fillStyle = id2Color[currentColorId];\n                currentFrom = zoneFrom;\n                currentTo = zoneTo;\n            }\n            else {\n                if (currentTo >= zoneFrom) {\n                    currentTo = Math.max(currentTo, zoneTo);\n                }\n                else {\n                    ctx.fillRect(0, currentFrom, width, currentTo - currentFrom);\n                    currentFrom = zoneFrom;\n                    currentTo = zoneTo;\n                }\n            }\n        }\n        ctx.fillRect(0, currentFrom, width, currentTo - currentFrom);\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}