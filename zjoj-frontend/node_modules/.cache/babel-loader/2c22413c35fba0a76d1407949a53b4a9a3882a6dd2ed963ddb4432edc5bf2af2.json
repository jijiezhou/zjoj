{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { getAllMethodNames } from '../../../base/common/objects.js';\nimport { EditorWorkerClient } from './editorWorkerService.js';\n/**\n * Create a new web worker that has model syncing capabilities built in.\n * Specify an AMD module to load that will `create` an object that will be proxied.\n */\nexport function createWebWorker(modelService, languageConfigurationService, opts) {\n  return new MonacoWebWorkerImpl(modelService, languageConfigurationService, opts);\n}\nclass MonacoWebWorkerImpl extends EditorWorkerClient {\n  constructor(modelService, languageConfigurationService, opts) {\n    super(modelService, opts.keepIdleModels || false, opts.label, languageConfigurationService);\n    this._foreignModuleId = opts.moduleId;\n    this._foreignModuleCreateData = opts.createData || null;\n    this._foreignModuleHost = opts.host || null;\n    this._foreignProxy = null;\n  }\n  // foreign host request\n  fhr(method, args) {\n    if (!this._foreignModuleHost || typeof this._foreignModuleHost[method] !== 'function') {\n      return Promise.reject(new Error('Missing method ' + method + ' or missing main thread foreign host.'));\n    }\n    try {\n      return Promise.resolve(this._foreignModuleHost[method].apply(this._foreignModuleHost, args));\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  }\n  _getForeignProxy() {\n    if (!this._foreignProxy) {\n      this._foreignProxy = this._getProxy().then(proxy => {\n        const foreignHostMethods = this._foreignModuleHost ? getAllMethodNames(this._foreignModuleHost) : [];\n        return proxy.loadForeignModule(this._foreignModuleId, this._foreignModuleCreateData, foreignHostMethods).then(foreignMethods => {\n          this._foreignModuleCreateData = null;\n          const proxyMethodRequest = (method, args) => {\n            return proxy.fmr(method, args);\n          };\n          const createProxyMethod = (method, proxyMethodRequest) => {\n            return function () {\n              const args = Array.prototype.slice.call(arguments, 0);\n              return proxyMethodRequest(method, args);\n            };\n          };\n          const foreignProxy = {};\n          for (const foreignMethod of foreignMethods) {\n            foreignProxy[foreignMethod] = createProxyMethod(foreignMethod, proxyMethodRequest);\n          }\n          return foreignProxy;\n        });\n      });\n    }\n    return this._foreignProxy;\n  }\n  getProxy() {\n    return this._getForeignProxy();\n  }\n  withSyncedResources(resources) {\n    return this._withSyncedResources(resources).then(_ => this.getProxy());\n  }\n}","map":{"version":3,"names":["getAllMethodNames","EditorWorkerClient","createWebWorker","modelService","languageConfigurationService","opts","MonacoWebWorkerImpl","constructor","keepIdleModels","label","_foreignModuleId","moduleId","_foreignModuleCreateData","createData","_foreignModuleHost","host","_foreignProxy","fhr","method","args","Promise","reject","Error","resolve","apply","e","_getForeignProxy","_getProxy","then","proxy","foreignHostMethods","loadForeignModule","foreignMethods","proxyMethodRequest","fmr","createProxyMethod","Array","prototype","slice","call","arguments","foreignProxy","foreignMethod","getProxy","withSyncedResources","resources","_withSyncedResources","_"],"sources":["/Users/zj/projects/zjoj/zjoj-frontend/node_modules/monaco-editor/esm/vs/editor/browser/services/webWorker.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { getAllMethodNames } from '../../../base/common/objects.js';\nimport { EditorWorkerClient } from './editorWorkerService.js';\n/**\n * Create a new web worker that has model syncing capabilities built in.\n * Specify an AMD module to load that will `create` an object that will be proxied.\n */\nexport function createWebWorker(modelService, languageConfigurationService, opts) {\n    return new MonacoWebWorkerImpl(modelService, languageConfigurationService, opts);\n}\nclass MonacoWebWorkerImpl extends EditorWorkerClient {\n    constructor(modelService, languageConfigurationService, opts) {\n        super(modelService, opts.keepIdleModels || false, opts.label, languageConfigurationService);\n        this._foreignModuleId = opts.moduleId;\n        this._foreignModuleCreateData = opts.createData || null;\n        this._foreignModuleHost = opts.host || null;\n        this._foreignProxy = null;\n    }\n    // foreign host request\n    fhr(method, args) {\n        if (!this._foreignModuleHost || typeof this._foreignModuleHost[method] !== 'function') {\n            return Promise.reject(new Error('Missing method ' + method + ' or missing main thread foreign host.'));\n        }\n        try {\n            return Promise.resolve(this._foreignModuleHost[method].apply(this._foreignModuleHost, args));\n        }\n        catch (e) {\n            return Promise.reject(e);\n        }\n    }\n    _getForeignProxy() {\n        if (!this._foreignProxy) {\n            this._foreignProxy = this._getProxy().then((proxy) => {\n                const foreignHostMethods = this._foreignModuleHost ? getAllMethodNames(this._foreignModuleHost) : [];\n                return proxy.loadForeignModule(this._foreignModuleId, this._foreignModuleCreateData, foreignHostMethods).then((foreignMethods) => {\n                    this._foreignModuleCreateData = null;\n                    const proxyMethodRequest = (method, args) => {\n                        return proxy.fmr(method, args);\n                    };\n                    const createProxyMethod = (method, proxyMethodRequest) => {\n                        return function () {\n                            const args = Array.prototype.slice.call(arguments, 0);\n                            return proxyMethodRequest(method, args);\n                        };\n                    };\n                    const foreignProxy = {};\n                    for (const foreignMethod of foreignMethods) {\n                        foreignProxy[foreignMethod] = createProxyMethod(foreignMethod, proxyMethodRequest);\n                    }\n                    return foreignProxy;\n                });\n            });\n        }\n        return this._foreignProxy;\n    }\n    getProxy() {\n        return this._getForeignProxy();\n    }\n    withSyncedResources(resources) {\n        return this._withSyncedResources(resources).then(_ => this.getProxy());\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}