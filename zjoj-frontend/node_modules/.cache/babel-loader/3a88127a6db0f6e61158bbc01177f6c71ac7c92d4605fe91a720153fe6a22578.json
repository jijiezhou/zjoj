{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.typed-array.to-reversed.js\";\nimport \"core-js/modules/es.typed-array.to-sorted.js\";\nimport \"core-js/modules/es.typed-array.with.js\";\n/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n    r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n    d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\nvar ModelSemanticColoring_1;\nimport { Disposable, dispose } from '../../../../base/common/lifecycle.js';\nimport * as errors from '../../../../base/common/errors.js';\nimport { IModelService } from '../../../common/services/model.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { RunOnceScheduler } from '../../../../base/common/async.js';\nimport { CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { toMultilineTokens2 } from '../../../common/services/semanticTokensProviderStyling.js';\nimport { getDocumentSemanticTokens, hasDocumentSemanticTokensProvider, isSemanticTokens, isSemanticTokensEdits } from '../common/getSemanticTokens.js';\nimport { ILanguageFeatureDebounceService } from '../../../common/services/languageFeatureDebounce.js';\nimport { StopWatch } from '../../../../base/common/stopwatch.js';\nimport { ILanguageFeaturesService } from '../../../common/services/languageFeatures.js';\nimport { ISemanticTokensStylingService } from '../../../common/services/semanticTokensStyling.js';\nimport { registerEditorFeature } from '../../../common/editorFeatures.js';\nimport { SEMANTIC_HIGHLIGHTING_SETTING_ID, isSemanticColoringEnabled } from '../common/semanticTokensConfig.js';\nlet DocumentSemanticTokensFeature = class DocumentSemanticTokensFeature extends Disposable {\n  constructor(semanticTokensStylingService, modelService, themeService, configurationService, languageFeatureDebounceService, languageFeaturesService) {\n    super();\n    this._watchers = Object.create(null);\n    const register = model => {\n      this._watchers[model.uri.toString()] = new ModelSemanticColoring(model, semanticTokensStylingService, themeService, languageFeatureDebounceService, languageFeaturesService);\n    };\n    const deregister = (model, modelSemanticColoring) => {\n      modelSemanticColoring.dispose();\n      delete this._watchers[model.uri.toString()];\n    };\n    const handleSettingOrThemeChange = () => {\n      for (const model of modelService.getModels()) {\n        const curr = this._watchers[model.uri.toString()];\n        if (isSemanticColoringEnabled(model, themeService, configurationService)) {\n          if (!curr) {\n            register(model);\n          }\n        } else {\n          if (curr) {\n            deregister(model, curr);\n          }\n        }\n      }\n    };\n    this._register(modelService.onModelAdded(model => {\n      if (isSemanticColoringEnabled(model, themeService, configurationService)) {\n        register(model);\n      }\n    }));\n    this._register(modelService.onModelRemoved(model => {\n      const curr = this._watchers[model.uri.toString()];\n      if (curr) {\n        deregister(model, curr);\n      }\n    }));\n    this._register(configurationService.onDidChangeConfiguration(e => {\n      if (e.affectsConfiguration(SEMANTIC_HIGHLIGHTING_SETTING_ID)) {\n        handleSettingOrThemeChange();\n      }\n    }));\n    this._register(themeService.onDidColorThemeChange(handleSettingOrThemeChange));\n  }\n  dispose() {\n    // Dispose all watchers\n    for (const watcher of Object.values(this._watchers)) {\n      watcher.dispose();\n    }\n    super.dispose();\n  }\n};\nDocumentSemanticTokensFeature = __decorate([__param(0, ISemanticTokensStylingService), __param(1, IModelService), __param(2, IThemeService), __param(3, IConfigurationService), __param(4, ILanguageFeatureDebounceService), __param(5, ILanguageFeaturesService)], DocumentSemanticTokensFeature);\nexport { DocumentSemanticTokensFeature };\nlet ModelSemanticColoring = ModelSemanticColoring_1 = class ModelSemanticColoring extends Disposable {\n  constructor(model, _semanticTokensStylingService, themeService, languageFeatureDebounceService, languageFeaturesService) {\n    super();\n    this._semanticTokensStylingService = _semanticTokensStylingService;\n    this._isDisposed = false;\n    this._model = model;\n    this._provider = languageFeaturesService.documentSemanticTokensProvider;\n    this._debounceInformation = languageFeatureDebounceService.for(this._provider, 'DocumentSemanticTokens', {\n      min: ModelSemanticColoring_1.REQUEST_MIN_DELAY,\n      max: ModelSemanticColoring_1.REQUEST_MAX_DELAY\n    });\n    this._fetchDocumentSemanticTokens = this._register(new RunOnceScheduler(() => this._fetchDocumentSemanticTokensNow(), ModelSemanticColoring_1.REQUEST_MIN_DELAY));\n    this._currentDocumentResponse = null;\n    this._currentDocumentRequestCancellationTokenSource = null;\n    this._documentProvidersChangeListeners = [];\n    this._providersChangedDuringRequest = false;\n    this._register(this._model.onDidChangeContent(() => {\n      if (!this._fetchDocumentSemanticTokens.isScheduled()) {\n        this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model));\n      }\n    }));\n    this._register(this._model.onDidChangeAttached(() => {\n      if (!this._fetchDocumentSemanticTokens.isScheduled()) {\n        this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model));\n      }\n    }));\n    this._register(this._model.onDidChangeLanguage(() => {\n      // clear any outstanding state\n      if (this._currentDocumentResponse) {\n        this._currentDocumentResponse.dispose();\n        this._currentDocumentResponse = null;\n      }\n      if (this._currentDocumentRequestCancellationTokenSource) {\n        this._currentDocumentRequestCancellationTokenSource.cancel();\n        this._currentDocumentRequestCancellationTokenSource = null;\n      }\n      this._setDocumentSemanticTokens(null, null, null, []);\n      this._fetchDocumentSemanticTokens.schedule(0);\n    }));\n    const bindDocumentChangeListeners = () => {\n      dispose(this._documentProvidersChangeListeners);\n      this._documentProvidersChangeListeners = [];\n      for (const provider of this._provider.all(model)) {\n        if (typeof provider.onDidChange === 'function') {\n          this._documentProvidersChangeListeners.push(provider.onDidChange(() => {\n            if (this._currentDocumentRequestCancellationTokenSource) {\n              // there is already a request running,\n              this._providersChangedDuringRequest = true;\n              return;\n            }\n            this._fetchDocumentSemanticTokens.schedule(0);\n          }));\n        }\n      }\n    };\n    bindDocumentChangeListeners();\n    this._register(this._provider.onDidChange(() => {\n      bindDocumentChangeListeners();\n      this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model));\n    }));\n    this._register(themeService.onDidColorThemeChange(_ => {\n      // clear out existing tokens\n      this._setDocumentSemanticTokens(null, null, null, []);\n      this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model));\n    }));\n    this._fetchDocumentSemanticTokens.schedule(0);\n  }\n  dispose() {\n    if (this._currentDocumentResponse) {\n      this._currentDocumentResponse.dispose();\n      this._currentDocumentResponse = null;\n    }\n    if (this._currentDocumentRequestCancellationTokenSource) {\n      this._currentDocumentRequestCancellationTokenSource.cancel();\n      this._currentDocumentRequestCancellationTokenSource = null;\n    }\n    dispose(this._documentProvidersChangeListeners);\n    this._documentProvidersChangeListeners = [];\n    this._setDocumentSemanticTokens(null, null, null, []);\n    this._isDisposed = true;\n    super.dispose();\n  }\n  _fetchDocumentSemanticTokensNow() {\n    if (this._currentDocumentRequestCancellationTokenSource) {\n      // there is already a request running, let it finish...\n      return;\n    }\n    if (!hasDocumentSemanticTokensProvider(this._provider, this._model)) {\n      // there is no provider\n      if (this._currentDocumentResponse) {\n        // there are semantic tokens set\n        this._model.tokenization.setSemanticTokens(null, false);\n      }\n      return;\n    }\n    if (!this._model.isAttachedToEditor()) {\n      // this document is not visible, there is no need to fetch semantic tokens for it\n      return;\n    }\n    const cancellationTokenSource = new CancellationTokenSource();\n    const lastProvider = this._currentDocumentResponse ? this._currentDocumentResponse.provider : null;\n    const lastResultId = this._currentDocumentResponse ? this._currentDocumentResponse.resultId || null : null;\n    const request = getDocumentSemanticTokens(this._provider, this._model, lastProvider, lastResultId, cancellationTokenSource.token);\n    this._currentDocumentRequestCancellationTokenSource = cancellationTokenSource;\n    this._providersChangedDuringRequest = false;\n    const pendingChanges = [];\n    const contentChangeListener = this._model.onDidChangeContent(e => {\n      pendingChanges.push(e);\n    });\n    const sw = new StopWatch(false);\n    request.then(res => {\n      this._debounceInformation.update(this._model, sw.elapsed());\n      this._currentDocumentRequestCancellationTokenSource = null;\n      contentChangeListener.dispose();\n      if (!res) {\n        this._setDocumentSemanticTokens(null, null, null, pendingChanges);\n      } else {\n        const {\n          provider,\n          tokens\n        } = res;\n        const styling = this._semanticTokensStylingService.getStyling(provider);\n        this._setDocumentSemanticTokens(provider, tokens || null, styling, pendingChanges);\n      }\n    }, err => {\n      const isExpectedError = err && (errors.isCancellationError(err) || typeof err.message === 'string' && err.message.indexOf('busy') !== -1);\n      if (!isExpectedError) {\n        errors.onUnexpectedError(err);\n      }\n      // Semantic tokens eats up all errors and considers errors to mean that the result is temporarily not available\n      // The API does not have a special error kind to express this...\n      this._currentDocumentRequestCancellationTokenSource = null;\n      contentChangeListener.dispose();\n      if (pendingChanges.length > 0 || this._providersChangedDuringRequest) {\n        // More changes occurred while the request was running\n        if (!this._fetchDocumentSemanticTokens.isScheduled()) {\n          this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model));\n        }\n      }\n    });\n  }\n  static _copy(src, srcOffset, dest, destOffset, length) {\n    // protect against overflows\n    length = Math.min(length, dest.length - destOffset, src.length - srcOffset);\n    for (let i = 0; i < length; i++) {\n      dest[destOffset + i] = src[srcOffset + i];\n    }\n  }\n  _setDocumentSemanticTokens(provider, tokens, styling, pendingChanges) {\n    const currentResponse = this._currentDocumentResponse;\n    const rescheduleIfNeeded = () => {\n      if ((pendingChanges.length > 0 || this._providersChangedDuringRequest) && !this._fetchDocumentSemanticTokens.isScheduled()) {\n        this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model));\n      }\n    };\n    if (this._currentDocumentResponse) {\n      this._currentDocumentResponse.dispose();\n      this._currentDocumentResponse = null;\n    }\n    if (this._isDisposed) {\n      // disposed!\n      if (provider && tokens) {\n        provider.releaseDocumentSemanticTokens(tokens.resultId);\n      }\n      return;\n    }\n    if (!provider || !styling) {\n      this._model.tokenization.setSemanticTokens(null, false);\n      return;\n    }\n    if (!tokens) {\n      this._model.tokenization.setSemanticTokens(null, true);\n      rescheduleIfNeeded();\n      return;\n    }\n    if (isSemanticTokensEdits(tokens)) {\n      if (!currentResponse) {\n        // not possible!\n        this._model.tokenization.setSemanticTokens(null, true);\n        return;\n      }\n      if (tokens.edits.length === 0) {\n        // nothing to do!\n        tokens = {\n          resultId: tokens.resultId,\n          data: currentResponse.data\n        };\n      } else {\n        let deltaLength = 0;\n        for (const edit of tokens.edits) {\n          deltaLength += (edit.data ? edit.data.length : 0) - edit.deleteCount;\n        }\n        const srcData = currentResponse.data;\n        const destData = new Uint32Array(srcData.length + deltaLength);\n        let srcLastStart = srcData.length;\n        let destLastStart = destData.length;\n        for (let i = tokens.edits.length - 1; i >= 0; i--) {\n          const edit = tokens.edits[i];\n          if (edit.start > srcData.length) {\n            styling.warnInvalidEditStart(currentResponse.resultId, tokens.resultId, i, edit.start, srcData.length);\n            // The edits are invalid and there's no way to recover\n            this._model.tokenization.setSemanticTokens(null, true);\n            return;\n          }\n          const copyCount = srcLastStart - (edit.start + edit.deleteCount);\n          if (copyCount > 0) {\n            ModelSemanticColoring_1._copy(srcData, srcLastStart - copyCount, destData, destLastStart - copyCount, copyCount);\n            destLastStart -= copyCount;\n          }\n          if (edit.data) {\n            ModelSemanticColoring_1._copy(edit.data, 0, destData, destLastStart - edit.data.length, edit.data.length);\n            destLastStart -= edit.data.length;\n          }\n          srcLastStart = edit.start;\n        }\n        if (srcLastStart > 0) {\n          ModelSemanticColoring_1._copy(srcData, 0, destData, 0, srcLastStart);\n        }\n        tokens = {\n          resultId: tokens.resultId,\n          data: destData\n        };\n      }\n    }\n    if (isSemanticTokens(tokens)) {\n      this._currentDocumentResponse = new SemanticTokensResponse(provider, tokens.resultId, tokens.data);\n      const result = toMultilineTokens2(tokens, styling, this._model.getLanguageId());\n      // Adjust incoming semantic tokens\n      if (pendingChanges.length > 0) {\n        // More changes occurred while the request was running\n        // We need to:\n        // 1. Adjust incoming semantic tokens\n        // 2. Request them again\n        for (const change of pendingChanges) {\n          for (const area of result) {\n            for (const singleChange of change.changes) {\n              area.applyEdit(singleChange.range, singleChange.text);\n            }\n          }\n        }\n      }\n      this._model.tokenization.setSemanticTokens(result, true);\n    } else {\n      this._model.tokenization.setSemanticTokens(null, true);\n    }\n    rescheduleIfNeeded();\n  }\n};\nModelSemanticColoring.REQUEST_MIN_DELAY = 300;\nModelSemanticColoring.REQUEST_MAX_DELAY = 2000;\nModelSemanticColoring = ModelSemanticColoring_1 = __decorate([__param(1, ISemanticTokensStylingService), __param(2, IThemeService), __param(3, ILanguageFeatureDebounceService), __param(4, ILanguageFeaturesService)], ModelSemanticColoring);\nclass SemanticTokensResponse {\n  constructor(provider, resultId, data) {\n    this.provider = provider;\n    this.resultId = resultId;\n    this.data = data;\n  }\n  dispose() {\n    this.provider.releaseDocumentSemanticTokens(this.resultId);\n  }\n}\nregisterEditorFeature(DocumentSemanticTokensFeature);","map":{"version":3,"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__param","paramIndex","decorator","ModelSemanticColoring_1","Disposable","dispose","errors","IModelService","IConfigurationService","RunOnceScheduler","CancellationTokenSource","IThemeService","toMultilineTokens2","getDocumentSemanticTokens","hasDocumentSemanticTokensProvider","isSemanticTokens","isSemanticTokensEdits","ILanguageFeatureDebounceService","StopWatch","ILanguageFeaturesService","ISemanticTokensStylingService","registerEditorFeature","SEMANTIC_HIGHLIGHTING_SETTING_ID","isSemanticColoringEnabled","DocumentSemanticTokensFeature","constructor","semanticTokensStylingService","modelService","themeService","configurationService","languageFeatureDebounceService","languageFeaturesService","_watchers","create","register","model","uri","toString","ModelSemanticColoring","deregister","modelSemanticColoring","handleSettingOrThemeChange","getModels","curr","_register","onModelAdded","onModelRemoved","onDidChangeConfiguration","e","affectsConfiguration","onDidColorThemeChange","watcher","values","_semanticTokensStylingService","_isDisposed","_model","_provider","documentSemanticTokensProvider","_debounceInformation","for","min","REQUEST_MIN_DELAY","max","REQUEST_MAX_DELAY","_fetchDocumentSemanticTokens","_fetchDocumentSemanticTokensNow","_currentDocumentResponse","_currentDocumentRequestCancellationTokenSource","_documentProvidersChangeListeners","_providersChangedDuringRequest","onDidChangeContent","isScheduled","schedule","get","onDidChangeAttached","onDidChangeLanguage","cancel","_setDocumentSemanticTokens","bindDocumentChangeListeners","provider","all","onDidChange","push","_","tokenization","setSemanticTokens","isAttachedToEditor","cancellationTokenSource","lastProvider","lastResultId","resultId","request","token","pendingChanges","contentChangeListener","sw","then","res","update","elapsed","tokens","styling","getStyling","err","isExpectedError","isCancellationError","message","indexOf","onUnexpectedError","_copy","src","srcOffset","dest","destOffset","Math","currentResponse","rescheduleIfNeeded","releaseDocumentSemanticTokens","edits","data","deltaLength","edit","deleteCount","srcData","destData","Uint32Array","srcLastStart","destLastStart","start","warnInvalidEditStart","copyCount","SemanticTokensResponse","result","getLanguageId","change","area","singleChange","changes","applyEdit","range","text"],"sources":["/Users/zj/projects/zjoj/zjoj-frontend/node_modules/monaco-editor/esm/vs/editor/contrib/semanticTokens/browser/documentSemanticTokens.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nvar ModelSemanticColoring_1;\nimport { Disposable, dispose } from '../../../../base/common/lifecycle.js';\nimport * as errors from '../../../../base/common/errors.js';\nimport { IModelService } from '../../../common/services/model.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { RunOnceScheduler } from '../../../../base/common/async.js';\nimport { CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { toMultilineTokens2 } from '../../../common/services/semanticTokensProviderStyling.js';\nimport { getDocumentSemanticTokens, hasDocumentSemanticTokensProvider, isSemanticTokens, isSemanticTokensEdits } from '../common/getSemanticTokens.js';\nimport { ILanguageFeatureDebounceService } from '../../../common/services/languageFeatureDebounce.js';\nimport { StopWatch } from '../../../../base/common/stopwatch.js';\nimport { ILanguageFeaturesService } from '../../../common/services/languageFeatures.js';\nimport { ISemanticTokensStylingService } from '../../../common/services/semanticTokensStyling.js';\nimport { registerEditorFeature } from '../../../common/editorFeatures.js';\nimport { SEMANTIC_HIGHLIGHTING_SETTING_ID, isSemanticColoringEnabled } from '../common/semanticTokensConfig.js';\nlet DocumentSemanticTokensFeature = class DocumentSemanticTokensFeature extends Disposable {\n    constructor(semanticTokensStylingService, modelService, themeService, configurationService, languageFeatureDebounceService, languageFeaturesService) {\n        super();\n        this._watchers = Object.create(null);\n        const register = (model) => {\n            this._watchers[model.uri.toString()] = new ModelSemanticColoring(model, semanticTokensStylingService, themeService, languageFeatureDebounceService, languageFeaturesService);\n        };\n        const deregister = (model, modelSemanticColoring) => {\n            modelSemanticColoring.dispose();\n            delete this._watchers[model.uri.toString()];\n        };\n        const handleSettingOrThemeChange = () => {\n            for (const model of modelService.getModels()) {\n                const curr = this._watchers[model.uri.toString()];\n                if (isSemanticColoringEnabled(model, themeService, configurationService)) {\n                    if (!curr) {\n                        register(model);\n                    }\n                }\n                else {\n                    if (curr) {\n                        deregister(model, curr);\n                    }\n                }\n            }\n        };\n        this._register(modelService.onModelAdded((model) => {\n            if (isSemanticColoringEnabled(model, themeService, configurationService)) {\n                register(model);\n            }\n        }));\n        this._register(modelService.onModelRemoved((model) => {\n            const curr = this._watchers[model.uri.toString()];\n            if (curr) {\n                deregister(model, curr);\n            }\n        }));\n        this._register(configurationService.onDidChangeConfiguration(e => {\n            if (e.affectsConfiguration(SEMANTIC_HIGHLIGHTING_SETTING_ID)) {\n                handleSettingOrThemeChange();\n            }\n        }));\n        this._register(themeService.onDidColorThemeChange(handleSettingOrThemeChange));\n    }\n    dispose() {\n        // Dispose all watchers\n        for (const watcher of Object.values(this._watchers)) {\n            watcher.dispose();\n        }\n        super.dispose();\n    }\n};\nDocumentSemanticTokensFeature = __decorate([\n    __param(0, ISemanticTokensStylingService),\n    __param(1, IModelService),\n    __param(2, IThemeService),\n    __param(3, IConfigurationService),\n    __param(4, ILanguageFeatureDebounceService),\n    __param(5, ILanguageFeaturesService)\n], DocumentSemanticTokensFeature);\nexport { DocumentSemanticTokensFeature };\nlet ModelSemanticColoring = ModelSemanticColoring_1 = class ModelSemanticColoring extends Disposable {\n    constructor(model, _semanticTokensStylingService, themeService, languageFeatureDebounceService, languageFeaturesService) {\n        super();\n        this._semanticTokensStylingService = _semanticTokensStylingService;\n        this._isDisposed = false;\n        this._model = model;\n        this._provider = languageFeaturesService.documentSemanticTokensProvider;\n        this._debounceInformation = languageFeatureDebounceService.for(this._provider, 'DocumentSemanticTokens', { min: ModelSemanticColoring_1.REQUEST_MIN_DELAY, max: ModelSemanticColoring_1.REQUEST_MAX_DELAY });\n        this._fetchDocumentSemanticTokens = this._register(new RunOnceScheduler(() => this._fetchDocumentSemanticTokensNow(), ModelSemanticColoring_1.REQUEST_MIN_DELAY));\n        this._currentDocumentResponse = null;\n        this._currentDocumentRequestCancellationTokenSource = null;\n        this._documentProvidersChangeListeners = [];\n        this._providersChangedDuringRequest = false;\n        this._register(this._model.onDidChangeContent(() => {\n            if (!this._fetchDocumentSemanticTokens.isScheduled()) {\n                this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model));\n            }\n        }));\n        this._register(this._model.onDidChangeAttached(() => {\n            if (!this._fetchDocumentSemanticTokens.isScheduled()) {\n                this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model));\n            }\n        }));\n        this._register(this._model.onDidChangeLanguage(() => {\n            // clear any outstanding state\n            if (this._currentDocumentResponse) {\n                this._currentDocumentResponse.dispose();\n                this._currentDocumentResponse = null;\n            }\n            if (this._currentDocumentRequestCancellationTokenSource) {\n                this._currentDocumentRequestCancellationTokenSource.cancel();\n                this._currentDocumentRequestCancellationTokenSource = null;\n            }\n            this._setDocumentSemanticTokens(null, null, null, []);\n            this._fetchDocumentSemanticTokens.schedule(0);\n        }));\n        const bindDocumentChangeListeners = () => {\n            dispose(this._documentProvidersChangeListeners);\n            this._documentProvidersChangeListeners = [];\n            for (const provider of this._provider.all(model)) {\n                if (typeof provider.onDidChange === 'function') {\n                    this._documentProvidersChangeListeners.push(provider.onDidChange(() => {\n                        if (this._currentDocumentRequestCancellationTokenSource) {\n                            // there is already a request running,\n                            this._providersChangedDuringRequest = true;\n                            return;\n                        }\n                        this._fetchDocumentSemanticTokens.schedule(0);\n                    }));\n                }\n            }\n        };\n        bindDocumentChangeListeners();\n        this._register(this._provider.onDidChange(() => {\n            bindDocumentChangeListeners();\n            this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model));\n        }));\n        this._register(themeService.onDidColorThemeChange(_ => {\n            // clear out existing tokens\n            this._setDocumentSemanticTokens(null, null, null, []);\n            this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model));\n        }));\n        this._fetchDocumentSemanticTokens.schedule(0);\n    }\n    dispose() {\n        if (this._currentDocumentResponse) {\n            this._currentDocumentResponse.dispose();\n            this._currentDocumentResponse = null;\n        }\n        if (this._currentDocumentRequestCancellationTokenSource) {\n            this._currentDocumentRequestCancellationTokenSource.cancel();\n            this._currentDocumentRequestCancellationTokenSource = null;\n        }\n        dispose(this._documentProvidersChangeListeners);\n        this._documentProvidersChangeListeners = [];\n        this._setDocumentSemanticTokens(null, null, null, []);\n        this._isDisposed = true;\n        super.dispose();\n    }\n    _fetchDocumentSemanticTokensNow() {\n        if (this._currentDocumentRequestCancellationTokenSource) {\n            // there is already a request running, let it finish...\n            return;\n        }\n        if (!hasDocumentSemanticTokensProvider(this._provider, this._model)) {\n            // there is no provider\n            if (this._currentDocumentResponse) {\n                // there are semantic tokens set\n                this._model.tokenization.setSemanticTokens(null, false);\n            }\n            return;\n        }\n        if (!this._model.isAttachedToEditor()) {\n            // this document is not visible, there is no need to fetch semantic tokens for it\n            return;\n        }\n        const cancellationTokenSource = new CancellationTokenSource();\n        const lastProvider = this._currentDocumentResponse ? this._currentDocumentResponse.provider : null;\n        const lastResultId = this._currentDocumentResponse ? this._currentDocumentResponse.resultId || null : null;\n        const request = getDocumentSemanticTokens(this._provider, this._model, lastProvider, lastResultId, cancellationTokenSource.token);\n        this._currentDocumentRequestCancellationTokenSource = cancellationTokenSource;\n        this._providersChangedDuringRequest = false;\n        const pendingChanges = [];\n        const contentChangeListener = this._model.onDidChangeContent((e) => {\n            pendingChanges.push(e);\n        });\n        const sw = new StopWatch(false);\n        request.then((res) => {\n            this._debounceInformation.update(this._model, sw.elapsed());\n            this._currentDocumentRequestCancellationTokenSource = null;\n            contentChangeListener.dispose();\n            if (!res) {\n                this._setDocumentSemanticTokens(null, null, null, pendingChanges);\n            }\n            else {\n                const { provider, tokens } = res;\n                const styling = this._semanticTokensStylingService.getStyling(provider);\n                this._setDocumentSemanticTokens(provider, tokens || null, styling, pendingChanges);\n            }\n        }, (err) => {\n            const isExpectedError = err && (errors.isCancellationError(err) || (typeof err.message === 'string' && err.message.indexOf('busy') !== -1));\n            if (!isExpectedError) {\n                errors.onUnexpectedError(err);\n            }\n            // Semantic tokens eats up all errors and considers errors to mean that the result is temporarily not available\n            // The API does not have a special error kind to express this...\n            this._currentDocumentRequestCancellationTokenSource = null;\n            contentChangeListener.dispose();\n            if (pendingChanges.length > 0 || this._providersChangedDuringRequest) {\n                // More changes occurred while the request was running\n                if (!this._fetchDocumentSemanticTokens.isScheduled()) {\n                    this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model));\n                }\n            }\n        });\n    }\n    static _copy(src, srcOffset, dest, destOffset, length) {\n        // protect against overflows\n        length = Math.min(length, dest.length - destOffset, src.length - srcOffset);\n        for (let i = 0; i < length; i++) {\n            dest[destOffset + i] = src[srcOffset + i];\n        }\n    }\n    _setDocumentSemanticTokens(provider, tokens, styling, pendingChanges) {\n        const currentResponse = this._currentDocumentResponse;\n        const rescheduleIfNeeded = () => {\n            if ((pendingChanges.length > 0 || this._providersChangedDuringRequest) && !this._fetchDocumentSemanticTokens.isScheduled()) {\n                this._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model));\n            }\n        };\n        if (this._currentDocumentResponse) {\n            this._currentDocumentResponse.dispose();\n            this._currentDocumentResponse = null;\n        }\n        if (this._isDisposed) {\n            // disposed!\n            if (provider && tokens) {\n                provider.releaseDocumentSemanticTokens(tokens.resultId);\n            }\n            return;\n        }\n        if (!provider || !styling) {\n            this._model.tokenization.setSemanticTokens(null, false);\n            return;\n        }\n        if (!tokens) {\n            this._model.tokenization.setSemanticTokens(null, true);\n            rescheduleIfNeeded();\n            return;\n        }\n        if (isSemanticTokensEdits(tokens)) {\n            if (!currentResponse) {\n                // not possible!\n                this._model.tokenization.setSemanticTokens(null, true);\n                return;\n            }\n            if (tokens.edits.length === 0) {\n                // nothing to do!\n                tokens = {\n                    resultId: tokens.resultId,\n                    data: currentResponse.data\n                };\n            }\n            else {\n                let deltaLength = 0;\n                for (const edit of tokens.edits) {\n                    deltaLength += (edit.data ? edit.data.length : 0) - edit.deleteCount;\n                }\n                const srcData = currentResponse.data;\n                const destData = new Uint32Array(srcData.length + deltaLength);\n                let srcLastStart = srcData.length;\n                let destLastStart = destData.length;\n                for (let i = tokens.edits.length - 1; i >= 0; i--) {\n                    const edit = tokens.edits[i];\n                    if (edit.start > srcData.length) {\n                        styling.warnInvalidEditStart(currentResponse.resultId, tokens.resultId, i, edit.start, srcData.length);\n                        // The edits are invalid and there's no way to recover\n                        this._model.tokenization.setSemanticTokens(null, true);\n                        return;\n                    }\n                    const copyCount = srcLastStart - (edit.start + edit.deleteCount);\n                    if (copyCount > 0) {\n                        ModelSemanticColoring_1._copy(srcData, srcLastStart - copyCount, destData, destLastStart - copyCount, copyCount);\n                        destLastStart -= copyCount;\n                    }\n                    if (edit.data) {\n                        ModelSemanticColoring_1._copy(edit.data, 0, destData, destLastStart - edit.data.length, edit.data.length);\n                        destLastStart -= edit.data.length;\n                    }\n                    srcLastStart = edit.start;\n                }\n                if (srcLastStart > 0) {\n                    ModelSemanticColoring_1._copy(srcData, 0, destData, 0, srcLastStart);\n                }\n                tokens = {\n                    resultId: tokens.resultId,\n                    data: destData\n                };\n            }\n        }\n        if (isSemanticTokens(tokens)) {\n            this._currentDocumentResponse = new SemanticTokensResponse(provider, tokens.resultId, tokens.data);\n            const result = toMultilineTokens2(tokens, styling, this._model.getLanguageId());\n            // Adjust incoming semantic tokens\n            if (pendingChanges.length > 0) {\n                // More changes occurred while the request was running\n                // We need to:\n                // 1. Adjust incoming semantic tokens\n                // 2. Request them again\n                for (const change of pendingChanges) {\n                    for (const area of result) {\n                        for (const singleChange of change.changes) {\n                            area.applyEdit(singleChange.range, singleChange.text);\n                        }\n                    }\n                }\n            }\n            this._model.tokenization.setSemanticTokens(result, true);\n        }\n        else {\n            this._model.tokenization.setSemanticTokens(null, true);\n        }\n        rescheduleIfNeeded();\n    }\n};\nModelSemanticColoring.REQUEST_MIN_DELAY = 300;\nModelSemanticColoring.REQUEST_MAX_DELAY = 2000;\nModelSemanticColoring = ModelSemanticColoring_1 = __decorate([\n    __param(1, ISemanticTokensStylingService),\n    __param(2, IThemeService),\n    __param(3, ILanguageFeatureDebounceService),\n    __param(4, ILanguageFeaturesService)\n], ModelSemanticColoring);\nclass SemanticTokensResponse {\n    constructor(provider, resultId, data) {\n        this.provider = provider;\n        this.resultId = resultId;\n        this.data = data;\n    }\n    dispose() {\n        this.provider.releaseDocumentSemanticTokens(this.resultId);\n    }\n}\nregisterEditorFeature(DocumentSemanticTokensFeature);\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}