{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { isObject, isArray } from './is.js';\nimport StringValidator from './rules/string.js';\nimport NumberValidator from './rules/number.js';\nimport ArrayValidator from './rules/array.js';\nimport ObjectValidator from './rules/object.js';\nimport BooleanValidator from './rules/boolean.js';\nimport TypeValidator from './rules/type.js';\nimport CustomValidator from './rules/custom.js';\nimport { mergeTemplate } from './util.js';\nexport { default as DefaultValidateMessage } from './locale/en-US.js';\nvar BValidate = function (obj, options) {\n  return new Validate(obj, Object.assign({\n    field: 'value'\n  }, options));\n};\nBValidate.globalConfig = {};\n// 全局生效校验信息\nBValidate.setGlobalConfig = function (options) {\n  BValidate.globalConfig = options || {};\n};\nvar Validate = function Validate(obj, _options) {\n  var globalConfig = BValidate.globalConfig;\n  var options = Object.assign(Object.assign(Object.assign({}, globalConfig), _options), {\n    validateMessages: mergeTemplate(globalConfig.validateMessages, _options.validateMessages)\n  });\n  this.string = new StringValidator(obj, options);\n  this.number = new NumberValidator(obj, options);\n  this.array = new ArrayValidator(obj, options);\n  this.object = new ObjectValidator(obj, options);\n  this.boolean = new BooleanValidator(obj, options);\n  this.type = new TypeValidator(obj, options);\n  this.custom = new CustomValidator(obj, options);\n};\nvar Schema = function Schema(schema, options) {\n  if (options === void 0) options = {};\n  this.schema = schema;\n  this.options = options;\n};\n// 更新校验信息\nSchema.prototype.messages = function messages(validateMessages) {\n  this.options = Object.assign(Object.assign({}, this.options), {\n    validateMessages: mergeTemplate(this.options.validateMessages, validateMessages)\n  });\n};\nSchema.prototype.validate = function validate(values, callback) {\n  var this$1$1 = this;\n  if (!isObject(values)) {\n    return;\n  }\n  var promises = [];\n  var errors = null;\n  function setError(key, error) {\n    if (!errors) {\n      errors = {};\n    }\n    if (!errors[key] || error.requiredError) {\n      errors[key] = error;\n    }\n  }\n  if (this.schema) {\n    Object.keys(this.schema).forEach(function (key) {\n      if (isArray(this$1$1.schema[key])) {\n        var loop = function (i) {\n          var rule = this$1$1.schema[key][i];\n          var type = rule.type;\n          var message = rule.message;\n          if (!type && !rule.validator) {\n            throw \"You must specify a type to field \" + key + \"!\";\n          }\n          var _options = Object.assign(Object.assign({}, this$1$1.options), {\n            message: message,\n            field: key\n          });\n          if ('ignoreEmptyString' in rule) {\n            _options.ignoreEmptyString = rule.ignoreEmptyString;\n          }\n          if ('strict' in rule) {\n            _options.strict = rule.strict;\n          }\n          var validator = new Validate(values[key], _options);\n          var bv = validator.type[type] || null;\n          if (!bv) {\n            if (rule.validator) {\n              bv = validator.custom.validate(rule.validator);\n              if (Object.prototype.toString.call(bv) === '[object Array]' && bv[0].then) {\n                promises.push({\n                  function: bv[0],\n                  _this: bv[1],\n                  key: key\n                });\n              } else if (bv) {\n                setError(key, bv);\n              }\n              return;\n            } else {\n              bv = validator[type];\n            }\n          }\n          Object.keys(rule).forEach(function (r) {\n            if (rule.required) {\n              bv = bv.isRequired;\n            }\n            if (r !== 'message' && bv[r] && rule[r] && typeof bv[r] === 'object') {\n              bv = bv[r];\n            }\n            if (bv[r] && rule[r] !== undefined && typeof bv[r] === 'function') {\n              bv = bv[r](rule[r]);\n            }\n          });\n          bv.collect(function (error) {\n            if (error) {\n              setError(key, error);\n            }\n          });\n          if (errors) {\n            return 'break';\n          }\n        };\n        for (var i = 0; i < this$1$1.schema[key].length; i++) {\n          var returned = loop(i);\n          if (returned === 'break') break;\n        }\n      }\n    });\n  }\n  if (promises.length > 0) {\n    Promise.all(promises.map(function (a) {\n      return a.function;\n    })).then(function () {\n      promises.forEach(function (promise) {\n        if (promise._this.error) {\n          setError(promise.key, promise._this.error);\n        }\n      });\n      callback && callback(errors);\n    });\n  } else {\n    callback && callback(errors);\n  }\n};\nexport { Schema, BValidate as default };","map":{"version":3,"names":["isObject","isArray","StringValidator","NumberValidator","ArrayValidator","ObjectValidator","BooleanValidator","TypeValidator","CustomValidator","mergeTemplate","default","DefaultValidateMessage","BValidate","obj","options","Validate","Object","assign","field","globalConfig","setGlobalConfig","_options","validateMessages","string","number","array","object","boolean","type","custom","Schema","schema","prototype","messages","validate","values","callback","this$1$1","promises","errors","setError","key","error","requiredError","keys","forEach","loop","i","rule","message","validator","ignoreEmptyString","strict","bv","toString","call","then","push","function","_this","r","required","isRequired","undefined","collect","length","returned","Promise","all","map","a","promise"],"sources":["/Users/zj/projects/zjoj/zjoj-frontend/node_modules/b-validate/es/index.js"],"sourcesContent":["import { isObject, isArray } from './is.js';\nimport StringValidator from './rules/string.js';\nimport NumberValidator from './rules/number.js';\nimport ArrayValidator from './rules/array.js';\nimport ObjectValidator from './rules/object.js';\nimport BooleanValidator from './rules/boolean.js';\nimport TypeValidator from './rules/type.js';\nimport CustomValidator from './rules/custom.js';\nimport { mergeTemplate } from './util.js';\nexport { default as DefaultValidateMessage } from './locale/en-US.js';\n\nvar BValidate = function (obj, options) {\n    return new Validate(obj, Object.assign({ field: 'value' }, options));\n};\nBValidate.globalConfig = {};\n// 全局生效校验信息\nBValidate.setGlobalConfig = function (options) {\n    BValidate.globalConfig = options || {};\n};\nvar Validate = function Validate(obj, _options) {\n    var globalConfig = BValidate.globalConfig;\n    var options = Object.assign(Object.assign(Object.assign({}, globalConfig), _options), { validateMessages: mergeTemplate(globalConfig.validateMessages, _options.validateMessages) });\n    this.string = new StringValidator(obj, options);\n    this.number = new NumberValidator(obj, options);\n    this.array = new ArrayValidator(obj, options);\n    this.object = new ObjectValidator(obj, options);\n    this.boolean = new BooleanValidator(obj, options);\n    this.type = new TypeValidator(obj, options);\n    this.custom = new CustomValidator(obj, options);\n};\nvar Schema = function Schema(schema, options) {\n    if ( options === void 0 ) options = {};\n\n    this.schema = schema;\n    this.options = options;\n};\n// 更新校验信息\nSchema.prototype.messages = function messages (validateMessages) {\n    this.options = Object.assign(Object.assign({}, this.options), { validateMessages: mergeTemplate(this.options.validateMessages, validateMessages) });\n};\nSchema.prototype.validate = function validate (values, callback) {\n        var this$1$1 = this;\n\n    if (!isObject(values)) {\n        return;\n    }\n    var promises = [];\n    var errors = null;\n    function setError(key, error) {\n        if (!errors) {\n            errors = {};\n        }\n        if (!errors[key] || error.requiredError) {\n            errors[key] = error;\n        }\n    }\n    if (this.schema) {\n        Object.keys(this.schema).forEach(function (key) {\n            if (isArray(this$1$1.schema[key])) {\n                var loop = function ( i ) {\n                    var rule = this$1$1.schema[key][i];\n                    var type = rule.type;\n                    var message = rule.message;\n                    if (!type && !rule.validator) {\n                        throw (\"You must specify a type to field \" + key + \"!\");\n                    }\n                    var _options = Object.assign(Object.assign({}, this$1$1.options), { message: message, field: key });\n                    if ('ignoreEmptyString' in rule) {\n                        _options.ignoreEmptyString = rule.ignoreEmptyString;\n                    }\n                    if ('strict' in rule) {\n                        _options.strict = rule.strict;\n                    }\n                    var validator = new Validate(values[key], _options);\n                    var bv = validator.type[type] || null;\n                    if (!bv) {\n                        if (rule.validator) {\n                            bv = validator.custom.validate(rule.validator);\n                            if (Object.prototype.toString.call(bv) === '[object Array]' && bv[0].then) {\n                                promises.push({\n                                    function: bv[0],\n                                    _this: bv[1],\n                                    key: key,\n                                });\n                            }\n                            else if (bv) {\n                                setError(key, bv);\n                            }\n                            return;\n                        }\n                        else {\n                            bv = validator[type];\n                        }\n                    }\n                    Object.keys(rule).forEach(function (r) {\n                        if (rule.required) {\n                            bv = bv.isRequired;\n                        }\n                        if (r !== 'message' && bv[r] && rule[r] && typeof bv[r] === 'object') {\n                            bv = bv[r];\n                        }\n                        if (bv[r] && rule[r] !== undefined && typeof bv[r] === 'function') {\n                            bv = bv[r](rule[r]);\n                        }\n                    });\n                    bv.collect(function (error) {\n                        if (error) {\n                            setError(key, error);\n                        }\n                    });\n                    if (errors) {\n                        return 'break';\n                    }\n                };\n\n                    for (var i = 0; i < this$1$1.schema[key].length; i++) {\n                        var returned = loop( i );\n\n                        if ( returned === 'break' ) break;\n                    }\n            }\n        });\n    }\n    if (promises.length > 0) {\n        Promise.all(promises.map(function (a) { return a.function; })).then(function () {\n            promises.forEach(function (promise) {\n                if (promise._this.error) {\n                    setError(promise.key, promise._this.error);\n                }\n            });\n            callback && callback(errors);\n        });\n    }\n    else {\n        callback && callback(errors);\n    }\n};\n\nexport { Schema, BValidate as default };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}