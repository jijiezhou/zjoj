{"ast":null,"code":"import { ref, watch, nextTick, provide, reactive } from \"vue\";\nimport { getRelativeRect } from \"../../_utils/dom.js\";\nimport { useOptions } from \"./use-options.js\";\nimport { getKeyDownHandler, KEYBOARD_KEY } from \"../../_utils/keyboard.js\";\nimport { selectInjectionKey } from \"../context.js\";\nconst useSelect = ({\n  multiple,\n  options,\n  extraOptions,\n  inputValue,\n  filterOption,\n  showExtraOptions,\n  component,\n  valueKey,\n  fieldNames,\n  loading,\n  popupVisible,\n  valueKeys,\n  dropdownRef,\n  optionRefs,\n  virtualListRef,\n  onSelect,\n  onPopupVisibleChange,\n  enterToOpen = true,\n  defaultActiveFirstOption\n}) => {\n  const {\n    validOptions,\n    optionInfoMap,\n    validOptionInfos,\n    enabledOptionKeys,\n    getNextSlotOptionIndex,\n    addSlotOptionInfo,\n    removeSlotOptionInfo\n  } = useOptions({\n    options,\n    extraOptions,\n    inputValue,\n    filterOption,\n    showExtraOptions,\n    valueKey,\n    fieldNames\n  });\n  const activeKey = ref();\n  watch(enabledOptionKeys, enabledKeys => {\n    if (!activeKey.value || !enabledKeys.includes(activeKey.value)) {\n      activeKey.value = enabledKeys[0];\n    }\n  });\n  const setActiveKey = key => {\n    activeKey.value = key;\n  };\n  const getNextActiveKey = direction => {\n    const _length = enabledOptionKeys.value.length;\n    if (_length === 0) {\n      return void 0;\n    }\n    if (!activeKey.value) {\n      if (direction === \"down\") {\n        return enabledOptionKeys.value[0];\n      }\n      return enabledOptionKeys.value[_length - 1];\n    }\n    const activeIndex = enabledOptionKeys.value.indexOf(activeKey.value);\n    const nextIndex = (_length + activeIndex + (direction === \"up\" ? -1 : 1)) % _length;\n    return enabledOptionKeys.value[nextIndex];\n  };\n  const scrollIntoView = key => {\n    var _a, _b;\n    if (virtualListRef == null ? void 0 : virtualListRef.value) {\n      virtualListRef.value.scrollTo({\n        key\n      });\n    }\n    const optionInfo = optionInfoMap.get(key);\n    const wrapperEle = (_a = dropdownRef == null ? void 0 : dropdownRef.value) == null ? void 0 : _a.wrapperRef;\n    const optionEle = (_b = optionRefs == null ? void 0 : optionRefs.value[key]) != null ? _b : optionInfo == null ? void 0 : optionInfo.ref;\n    if (!wrapperEle || !optionEle) {\n      return;\n    }\n    if (wrapperEle.scrollHeight === wrapperEle.offsetHeight) {\n      return;\n    }\n    const optionRect = getRelativeRect(optionEle, wrapperEle);\n    const wrapperScrollTop = wrapperEle.scrollTop;\n    if (optionRect.top < 0) {\n      wrapperEle.scrollTo(0, wrapperScrollTop + optionRect.top);\n    } else if (optionRect.bottom < 0) {\n      wrapperEle.scrollTo(0, wrapperScrollTop - optionRect.bottom);\n    }\n  };\n  watch(popupVisible, visible => {\n    var _a;\n    if (visible) {\n      const current = valueKeys.value[valueKeys.value.length - 1];\n      let _activeKey = ((_a = defaultActiveFirstOption == null ? void 0 : defaultActiveFirstOption.value) != null ? _a : true) ? enabledOptionKeys.value[0] : void 0;\n      if (enabledOptionKeys.value.includes(current)) {\n        _activeKey = current;\n      }\n      if (_activeKey !== activeKey.value) {\n        activeKey.value = _activeKey;\n      }\n      nextTick(() => {\n        if (activeKey.value) {\n          scrollIntoView(activeKey.value);\n        }\n      });\n    }\n  });\n  const handleKeyDown = getKeyDownHandler(new Map([[KEYBOARD_KEY.ENTER, e => {\n    if (!(loading == null ? void 0 : loading.value) && !e.isComposing) {\n      if (popupVisible.value) {\n        if (activeKey.value) {\n          onSelect(activeKey.value, e);\n          e.preventDefault();\n        }\n      } else if (enterToOpen) {\n        onPopupVisibleChange(true);\n        e.preventDefault();\n      }\n    }\n  }], [KEYBOARD_KEY.ESC, e => {\n    if (popupVisible.value) {\n      onPopupVisibleChange(false);\n      e.preventDefault();\n    }\n  }], [KEYBOARD_KEY.ARROW_DOWN, e => {\n    if (popupVisible.value) {\n      const next = getNextActiveKey(\"down\");\n      if (next) {\n        activeKey.value = next;\n        scrollIntoView(next);\n      }\n      e.preventDefault();\n    }\n  }], [KEYBOARD_KEY.ARROW_UP, e => {\n    if (popupVisible.value) {\n      const next = getNextActiveKey(\"up\");\n      if (next) {\n        activeKey.value = next;\n        scrollIntoView(next);\n      }\n      e.preventDefault();\n    }\n  }]]));\n  provide(selectInjectionKey, reactive({\n    multiple,\n    valueKey,\n    inputValue,\n    filterOption,\n    component,\n    valueKeys,\n    activeKey,\n    setActiveKey,\n    onSelect,\n    getNextSlotOptionIndex,\n    addSlotOptionInfo,\n    removeSlotOptionInfo\n  }));\n  return {\n    validOptions,\n    optionInfoMap,\n    validOptionInfos,\n    enabledOptionKeys,\n    activeKey,\n    setActiveKey,\n    addSlotOptionInfo,\n    removeSlotOptionInfo,\n    getNextActiveKey,\n    scrollIntoView,\n    handleKeyDown\n  };\n};\nexport { useSelect };","map":{"version":3,"names":["ref","watch","nextTick","provide","reactive","getRelativeRect","useOptions","getKeyDownHandler","KEYBOARD_KEY","selectInjectionKey","useSelect","multiple","options","extraOptions","inputValue","filterOption","showExtraOptions","component","valueKey","fieldNames","loading","popupVisible","valueKeys","dropdownRef","optionRefs","virtualListRef","onSelect","onPopupVisibleChange","enterToOpen","defaultActiveFirstOption","validOptions","optionInfoMap","validOptionInfos","enabledOptionKeys","getNextSlotOptionIndex","addSlotOptionInfo","removeSlotOptionInfo","activeKey","enabledKeys","value","includes","setActiveKey","key","getNextActiveKey","direction","_length","length","activeIndex","indexOf","nextIndex","scrollIntoView","_a","_b","scrollTo","optionInfo","get","wrapperEle","wrapperRef","optionEle","scrollHeight","offsetHeight","optionRect","wrapperScrollTop","scrollTop","top","bottom","visible","current","_activeKey","handleKeyDown","Map","ENTER","e","isComposing","preventDefault","ESC","ARROW_DOWN","next","ARROW_UP"],"sources":["/Users/zj/projects/zjoj/zjoj-frontend/node_modules/@arco-design/web-vue/es/select/hooks/use-select.js"],"sourcesContent":["import { ref, watch, nextTick, provide, reactive } from \"vue\";\nimport { getRelativeRect } from \"../../_utils/dom.js\";\nimport { useOptions } from \"./use-options.js\";\nimport { getKeyDownHandler, KEYBOARD_KEY } from \"../../_utils/keyboard.js\";\nimport { selectInjectionKey } from \"../context.js\";\nconst useSelect = ({\n  multiple,\n  options,\n  extraOptions,\n  inputValue,\n  filterOption,\n  showExtraOptions,\n  component,\n  valueKey,\n  fieldNames,\n  loading,\n  popupVisible,\n  valueKeys,\n  dropdownRef,\n  optionRefs,\n  virtualListRef,\n  onSelect,\n  onPopupVisibleChange,\n  enterToOpen = true,\n  defaultActiveFirstOption\n}) => {\n  const {\n    validOptions,\n    optionInfoMap,\n    validOptionInfos,\n    enabledOptionKeys,\n    getNextSlotOptionIndex,\n    addSlotOptionInfo,\n    removeSlotOptionInfo\n  } = useOptions({\n    options,\n    extraOptions,\n    inputValue,\n    filterOption,\n    showExtraOptions,\n    valueKey,\n    fieldNames\n  });\n  const activeKey = ref();\n  watch(enabledOptionKeys, (enabledKeys) => {\n    if (!activeKey.value || !enabledKeys.includes(activeKey.value)) {\n      activeKey.value = enabledKeys[0];\n    }\n  });\n  const setActiveKey = (key) => {\n    activeKey.value = key;\n  };\n  const getNextActiveKey = (direction) => {\n    const _length = enabledOptionKeys.value.length;\n    if (_length === 0) {\n      return void 0;\n    }\n    if (!activeKey.value) {\n      if (direction === \"down\") {\n        return enabledOptionKeys.value[0];\n      }\n      return enabledOptionKeys.value[_length - 1];\n    }\n    const activeIndex = enabledOptionKeys.value.indexOf(activeKey.value);\n    const nextIndex = (_length + activeIndex + (direction === \"up\" ? -1 : 1)) % _length;\n    return enabledOptionKeys.value[nextIndex];\n  };\n  const scrollIntoView = (key) => {\n    var _a, _b;\n    if (virtualListRef == null ? void 0 : virtualListRef.value) {\n      virtualListRef.value.scrollTo({ key });\n    }\n    const optionInfo = optionInfoMap.get(key);\n    const wrapperEle = (_a = dropdownRef == null ? void 0 : dropdownRef.value) == null ? void 0 : _a.wrapperRef;\n    const optionEle = (_b = optionRefs == null ? void 0 : optionRefs.value[key]) != null ? _b : optionInfo == null ? void 0 : optionInfo.ref;\n    if (!wrapperEle || !optionEle) {\n      return;\n    }\n    if (wrapperEle.scrollHeight === wrapperEle.offsetHeight) {\n      return;\n    }\n    const optionRect = getRelativeRect(optionEle, wrapperEle);\n    const wrapperScrollTop = wrapperEle.scrollTop;\n    if (optionRect.top < 0) {\n      wrapperEle.scrollTo(0, wrapperScrollTop + optionRect.top);\n    } else if (optionRect.bottom < 0) {\n      wrapperEle.scrollTo(0, wrapperScrollTop - optionRect.bottom);\n    }\n  };\n  watch(popupVisible, (visible) => {\n    var _a;\n    if (visible) {\n      const current = valueKeys.value[valueKeys.value.length - 1];\n      let _activeKey = ((_a = defaultActiveFirstOption == null ? void 0 : defaultActiveFirstOption.value) != null ? _a : true) ? enabledOptionKeys.value[0] : void 0;\n      if (enabledOptionKeys.value.includes(current)) {\n        _activeKey = current;\n      }\n      if (_activeKey !== activeKey.value) {\n        activeKey.value = _activeKey;\n      }\n      nextTick(() => {\n        if (activeKey.value) {\n          scrollIntoView(activeKey.value);\n        }\n      });\n    }\n  });\n  const handleKeyDown = getKeyDownHandler(new Map([\n    [\n      KEYBOARD_KEY.ENTER,\n      (e) => {\n        if (!(loading == null ? void 0 : loading.value) && !e.isComposing) {\n          if (popupVisible.value) {\n            if (activeKey.value) {\n              onSelect(activeKey.value, e);\n              e.preventDefault();\n            }\n          } else if (enterToOpen) {\n            onPopupVisibleChange(true);\n            e.preventDefault();\n          }\n        }\n      }\n    ],\n    [\n      KEYBOARD_KEY.ESC,\n      (e) => {\n        if (popupVisible.value) {\n          onPopupVisibleChange(false);\n          e.preventDefault();\n        }\n      }\n    ],\n    [\n      KEYBOARD_KEY.ARROW_DOWN,\n      (e) => {\n        if (popupVisible.value) {\n          const next = getNextActiveKey(\"down\");\n          if (next) {\n            activeKey.value = next;\n            scrollIntoView(next);\n          }\n          e.preventDefault();\n        }\n      }\n    ],\n    [\n      KEYBOARD_KEY.ARROW_UP,\n      (e) => {\n        if (popupVisible.value) {\n          const next = getNextActiveKey(\"up\");\n          if (next) {\n            activeKey.value = next;\n            scrollIntoView(next);\n          }\n          e.preventDefault();\n        }\n      }\n    ]\n  ]));\n  provide(selectInjectionKey, reactive({\n    multiple,\n    valueKey,\n    inputValue,\n    filterOption,\n    component,\n    valueKeys,\n    activeKey,\n    setActiveKey,\n    onSelect,\n    getNextSlotOptionIndex,\n    addSlotOptionInfo,\n    removeSlotOptionInfo\n  }));\n  return {\n    validOptions,\n    optionInfoMap,\n    validOptionInfos,\n    enabledOptionKeys,\n    activeKey,\n    setActiveKey,\n    addSlotOptionInfo,\n    removeSlotOptionInfo,\n    getNextActiveKey,\n    scrollIntoView,\n    handleKeyDown\n  };\n};\nexport { useSelect };\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}